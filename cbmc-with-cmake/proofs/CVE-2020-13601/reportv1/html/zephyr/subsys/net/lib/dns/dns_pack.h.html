
<html>
<head>
<title>zephyr/subsys/net/lib/dns/dns_pack.h</title>
<link rel="stylesheet" type="text/css" href="../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2016 Intel Corporation</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * SPDX-License-Identifier: Apache-2.0</div><div id="5" class="line none">    5  */</div><div id="6" class="line none">    6 </div><div id="7" class="line none">    7 #ifndef <a href="dns_pack.h.html#8">_DNS_PACK_H_</a></div><div id="8" class="line none">    8 #define <a href="dns_pack.h.html#8">_DNS_PACK_H_</a></div><div id="9" class="line none">    9 </div><div id="10" class="line none">   10 #include &lt;zephyr/net/net_ip.h&gt;</div><div id="11" class="line none">   11 #include &lt;zephyr/net/buf.h&gt;</div><div id="12" class="line none">   12 </div><div id="13" class="line none">   13 #include &lt;zephyr/types.h&gt;</div><div id="14" class="line none">   14 #include &lt;stddef.h&gt;</div><div id="15" class="line none">   15 #include &lt;errno.h&gt;</div><div id="16" class="line none">   16 </div><div id="17" class="line none">   17 /* See RFC 1035, 4.1.1 Header section format</div><div id="18" class="line none">   18  * DNS Message Header is always 12 bytes</div><div id="19" class="line none">   19  */</div><div id="20" class="line none">   20 #define <a href="dns_pack.h.html#20">DNS_MSG_HEADER_SIZE</a>     12</div><div id="21" class="line none">   21 </div><div id="22" class="line none">   22 /* This is the label's length octet, see 4.1.2. Question section format */</div><div id="23" class="line none">   23 #define <a href="dns_pack.h.html#23">DNS_LABEL_LEN_SIZE</a>      1</div><div id="24" class="line none">   24 #define <a href="dns_pack.h.html#24">DNS_POINTER_SIZE</a>        2</div><div id="25" class="line none">   25 #define <a href="dns_pack.h.html#25">DNS_LABEL_MIN_SIZE</a>      1</div><div id="26" class="line none">   26 #define <a href="dns_pack.h.html#26">DNS_LABEL_MAX_SIZE</a>      63</div><div id="27" class="line none">   27 #define <a href="dns_pack.h.html#27">DNS_NAME_MAX_SIZE</a>       255</div><div id="28" class="line none">   28 #define <a href="dns_pack.h.html#28">DNS_ANSWER_MIN_SIZE</a>     12</div><div id="29" class="line none">   29 #define <a href="dns_pack.h.html#29">DNS_COMMON_UINT_SIZE</a>    2</div><div id="30" class="line none">   30 </div><div id="31" class="line none">   31 #define <a href="dns_pack.h.html#31">DNS_HEADER_ID_LEN</a>       2</div><div id="32" class="line none">   32 #define <a href="dns_pack.h.html#32">DNS_HEADER_FLAGS_LEN</a>    2</div><div id="33" class="line none">   33 #define <a href="dns_pack.h.html#33">DNS_QTYPE_LEN</a>           2</div><div id="34" class="line none">   34 #define <a href="dns_pack.h.html#34">DNS_QCLASS_LEN</a>          2</div><div id="35" class="line none">   35 #define <a href="dns_pack.h.html#35">DNS_QDCOUNT_LEN</a>         2</div><div id="36" class="line none">   36 #define <a href="dns_pack.h.html#36">DNS_ANCOUNT_LEN</a>         2</div><div id="37" class="line none">   37 #define <a href="dns_pack.h.html#37">DNS_NSCOUNT_LEN</a>         2</div><div id="38" class="line none">   38 #define <a href="dns_pack.h.html#38">DNS_ARCOUNT_LEN</a>         2</div><div id="39" class="line none">   39 #define <a href="dns_pack.h.html#39">DNS_TTL_LEN</a>             4</div><div id="40" class="line none">   40 #define <a href="dns_pack.h.html#40">DNS_RDLENGTH_LEN</a>        2</div><div id="41" class="line none">   41 </div><div id="42" class="line none">   42 #define <a href="dns_pack.h.html#42">NS_CMPRSFLGS</a>    0xc0   /* DNS name compression */</div><div id="43" class="line none">   43 </div><div id="44" class="line none">   44 /* RFC 1035 '4.1.1. Header section format' defines the following flags:</div><div id="45" class="line none">   45  * QR, Opcode, AA, TC, RD, RA, Z and RCODE.</div><div id="46" class="line none">   46  * This implementation only uses RD (Recursion Desired).</div><div id="47" class="line none">   47  */</div><div id="48" class="line none">   48 #define <a href="dns_pack.h.html#48">DNS_RECURSION</a>           1</div><div id="49" class="line none">   49 </div><div id="50" class="line none">   50 /* These two defines represent the 3rd and 4th bytes of the DNS msg header.</div><div id="51" class="line none">   51  * See RFC 1035, 4.1.1. Header section format.</div><div id="52" class="line none">   52  */</div><div id="53" class="line none">   53 #define <a href="dns_pack.h.html#53">DNS_FLAGS1</a>              <a href="dns_pack.h.html#48">DNS_RECURSION</a>   /* QR, Opcode, AA, and TC = 0 */</div><div id="54" class="line none">   54 #define <a href="dns_pack.h.html#54">DNS_FLAGS2</a>              0               /* RA, Z and RCODE = 0 */</div><div id="55" class="line none">   55 </div><div id="56" class="line none">   56 /**</div><div id="57" class="line none">   57  * DNS message structure for DNS responses</div><div id="58" class="line none">   58  *</div><div id="59" class="line none">   59  * Structure that points to the buffer containing the DNS message. It also</div><div id="60" class="line none">   60  * contains some decodified message's properties that can not be recovered</div><div id="61" class="line none">   61  * easily:</div><div id="62" class="line none">   62  * - cname_offset</div><div id="63" class="line none">   63  * - query_offset</div><div id="64" class="line none">   64  * - answer_offset:</div><div id="65" class="line none">   65  *     + response_type: It indicates the response's content type. It could be</div><div id="66" class="line none">   66  *       an IP address, a CNAME with IP (two answers), a CNAME with no IP</div><div id="67" class="line none">   67  *       address. See enum dns_response_type for more details.</div><div id="68" class="line none">   68  *     + response_position: this is an offset. It holds the starting byte of</div><div id="69" class="line none">   69  *       the field containing the desired info. For example an IPv4 address.</div><div id="70" class="line none">   70  *     + response_length: this is an offset. It holds the response's length.</div><div id="71" class="line none">   71  */</div><div id="72" class="line none">   72 struct <a href="dns_pack.h.html#72">dns_msg_t</a> {</div><div id="73" class="line none">   73         uint8_t *<a href="dns_pack.h.html#73">msg</a>;</div><div id="74" class="line none">   74 </div><div id="75" class="line none">   75         int <a href="dns_pack.h.html#75">response_type</a>;</div><div id="76" class="line none">   76         uint16_t <a href="dns_pack.h.html#76">response_position</a>;</div><div id="77" class="line none">   77         uint16_t <a href="dns_pack.h.html#77">response_length</a>;</div><div id="78" class="line none">   78 </div><div id="79" class="line none">   79         uint16_t <a href="dns_pack.h.html#79">query_offset</a>;</div><div id="80" class="line none">   80         uint16_t <a href="dns_pack.h.html#80">answer_offset</a>;</div><div id="81" class="line none">   81         uint16_t <a href="dns_pack.h.html#81">msg_size</a>;</div><div id="82" class="line none">   82 };</div><div id="83" class="line none">   83 </div><div id="84" class="line none">   84 #define <a href="dns_pack.h.html#84">DNS_MSG_INIT</a>(<a href="../../../../include/zephyr/net/buf.h.html#1046">b</a>, s)      {.<a href="dns_pack.h.html#73">msg</a> = <a href="../../../../include/zephyr/net/buf.h.html#1046">b</a>, .<a href="dns_pack.h.html#81">msg_size</a> = s,       \</div><div id="85" class="line none">   85                                  .<a href="dns_pack.h.html#75">response_type</a> = -EINVAL}</div><div id="86" class="line none">   86 </div><div id="87" class="line none">   87 </div><div id="88" class="line none">   88 enum <a href="dns_pack.h.html#88">dns_rr_type</a> {</div><div id="89" class="line none">   89         <a href="dns_pack.h.html#89">DNS_RR_TYPE_INVALID</a> = 0,</div><div id="90" class="line none">   90         <a href="dns_pack.h.html#90">DNS_RR_TYPE_A</a>   = 1,            /* IPv4  */</div><div id="91" class="line none">   91         <a href="dns_pack.h.html#91">DNS_RR_TYPE_CNAME</a> = 5,          /* CNAME */</div><div id="92" class="line none">   92         <a href="dns_pack.h.html#92">DNS_RR_TYPE_PTR</a> = 12,           /* PTR   */</div><div id="93" class="line none">   93         <a href="dns_pack.h.html#93">DNS_RR_TYPE_TXT</a> = 16,           /* TXT   */</div><div id="94" class="line none">   94         <a href="dns_pack.h.html#94">DNS_RR_TYPE_AAAA</a> = 28,          /* IPv6  */</div><div id="95" class="line none">   95         <a href="dns_pack.h.html#95">DNS_RR_TYPE_SRV</a> = 33,           /* SRV   */</div><div id="96" class="line none">   96         <a href="dns_pack.h.html#96">DNS_RR_TYPE_ANY</a> = 0xff,         /* ANY (all records)   */</div><div id="97" class="line none">   97 };</div><div id="98" class="line none">   98 </div><div id="99" class="line none">   99 enum <a href="dns_pack.h.html#99">dns_response_type</a> {</div><div id="100" class="line none">  100         <a href="dns_pack.h.html#100">DNS_RESPONSE_INVALID</a> = -EINVAL,</div><div id="101" class="line none">  101         <a href="dns_pack.h.html#101">DNS_RESPONSE_IP</a>,</div><div id="102" class="line none">  102         <a href="dns_pack.h.html#102">DNS_RESPONSE_CNAME_WITH_IP</a>,</div><div id="103" class="line none">  103         <a href="dns_pack.h.html#103">DNS_RESPONSE_CNAME_NO_IP</a></div><div id="104" class="line none">  104 };</div><div id="105" class="line none">  105 </div><div id="106" class="line none">  106 enum <a href="dns_pack.h.html#106">dns_class</a> {</div><div id="107" class="line none">  107         <a href="dns_pack.h.html#107">DNS_CLASS_INVALID</a> = 0,</div><div id="108" class="line none">  108         <a href="dns_pack.h.html#108">DNS_CLASS_IN</a>,</div><div id="109" class="line none">  109         <a href="dns_pack.h.html#109">DNS_CLASS_FLUSH</a> = BIT(15)</div><div id="110" class="line none">  110 };</div><div id="111" class="line none">  111 </div><div id="112" class="line none">  112 enum <a href="dns_pack.h.html#112">dns_msg_type</a> {</div><div id="113" class="line none">  113         <a href="dns_pack.h.html#113">DNS_QUERY</a> = 0,</div><div id="114" class="line none">  114         <a href="dns_pack.h.html#114">DNS_RESPONSE</a></div><div id="115" class="line none">  115 };</div><div id="116" class="line none">  116 </div><div id="117" class="line none">  117 enum <a href="dns_pack.h.html#241">dns_header_rcode</a> {</div><div id="118" class="line none">  118         <a href="dns_pack.h.html#118">DNS_HEADER_NOERROR</a> = 0,</div><div id="119" class="line none">  119         <a href="dns_pack.h.html#119">DNS_HEADER_FORMATERROR</a>,</div><div id="120" class="line none">  120         <a href="dns_pack.h.html#120">DNS_HEADER_SERVERFAILURE</a>,</div><div id="121" class="line none">  121         <a href="dns_pack.h.html#121">DNS_HEADER_NAMEERROR</a>,</div><div id="122" class="line none">  122         <a href="dns_pack.h.html#122">DNS_HEADER_NOTIMPLEMENTED</a>,</div><div id="123" class="line none">  123         <a href="dns_pack.h.html#123">DNS_HEADER_REFUSED</a></div><div id="124" class="line none">  124 };</div><div id="125" class="line none">  125 </div><div id="126" class="line none">  126 struct <a href="dns_pack.h.html#126">dns_header</a> {</div><div id="127" class="line none">  127         /** Transaction ID */</div><div id="128" class="line none">  128         uint16_t <a href="../../../../include/zephyr/net/net_ip.h.html#538">id</a>;</div><div id="129" class="line none">  129         /**</div><div id="130" class="line none">  130          * | Name | Bit Position | Width | Description |</div><div id="131" class="line none">  131          * |------|--------------|-------|-------------|</div><div id="132" class="line none">  132          * | RCODE | 0 | 4 | Response / Error code |</div><div id="133" class="line none">  133          * | CD | 4 | 1 | |</div><div id="134" class="line none">  134          * | AD | 5 | 1 | Authenticated Data. 0 := Unacceptable, 1 := Acceptable |</div><div id="135" class="line none">  135          * | Z | 6 | 1 | Reserved (WZ/RAZ) |</div><div id="136" class="line none">  136          * | RA | 7 | 1 | Recursion Available. 0 := Unavailable, 1 := Available |</div><div id="137" class="line none">  137          * | RD | 8 | 1 | Recursion Desired. 0 := No Recursion, 1 := Recursion |</div><div id="138" class="line none">  138          * | TC | 9 | 1 | 0 := Not Truncated, 1 := Truncated |</div><div id="139" class="line none">  139          * | AA | 10 | 1 | Answer Authenticated / Answer Authoritative. 0 := Not Authenticated, 1 := Authenticated|</div><div id="140" class="line none">  140          * | Opcode | 11 | 4 | See @ref dns_opcode |</div><div id="141" class="line none">  141          * | QR | 15 | 1 | 0 := Query, 1 := Response |</div><div id="142" class="line none">  142          */</div><div id="143" class="line none">  143         uint16_t <a href="../../../../include/zephyr/net/buf.h.html#1015">flags</a>;</div><div id="144" class="line none">  144         /** Query count */</div><div id="145" class="line none">  145         uint16_t <a href="dns_pack.h.html#145">qdcount</a>;</div><div id="146" class="line none">  146         /** Answer count */</div><div id="147" class="line none">  147         uint16_t <a href="dns_pack.h.html#147">ancount</a>;</div><div id="148" class="line none">  148         /** Authority count */</div><div id="149" class="line none">  149         uint16_t <a href="dns_pack.h.html#149">nscount</a>;</div><div id="150" class="line none">  150         /** Additional information count */</div><div id="151" class="line none">  151         uint16_t <a href="dns_pack.h.html#151">arcount</a>;</div><div id="152" class="line none">  152         /** Flexible array member for records */</div><div id="153" class="line none">  153         uint8_t <a href="../../../../include/zephyr/net/buf.h.html#89">data</a>[];</div><div id="154" class="line none">  154 } <a href="../../../../include/zephyr/net/net_ip.h.html#486">__packed</a>;</div><div id="155" class="line none">  155 </div><div id="156" class="line none">  156 struct <a href="dns_pack.h.html#156">dns_query</a> {</div><div id="157" class="line none">  157         uint16_t <a href="../../../../include/zephyr/net/net_ip.h.html#555">type</a>;</div><div id="158" class="line none">  158         uint16_t <a href="dns_pack.h.html#158">class_</a>;</div><div id="159" class="line none">  159 } <a href="../../../../include/zephyr/net/net_ip.h.html#486">__packed</a>;</div><div id="160" class="line none">  160 </div><div id="161" class="line none">  161 struct <a href="dns_pack.h.html#161">dns_rr</a> {</div><div id="162" class="line none">  162         uint16_t <a href="../../../../include/zephyr/net/net_ip.h.html#555">type</a>;</div><div id="163" class="line none">  163         uint16_t <a href="dns_pack.h.html#158">class_</a>;</div><div id="164" class="line none">  164         uint32_t <a href="../../../../include/zephyr/net/net_ip.h.html#547">ttl</a>;</div><div id="165" class="line none">  165         uint16_t <a href="dns_pack.h.html#165">rdlength</a>;</div><div id="166" class="line none">  166         uint8_t <a href="dns_pack.h.html#166">rdata</a>[];</div><div id="167" class="line none">  167 } <a href="../../../../include/zephyr/net/net_ip.h.html#486">__packed</a>;</div><div id="168" class="line none">  168 </div><div id="169" class="line none">  169 struct <a href="dns_pack.h.html#169">dns_srv_rdata</a> {</div><div id="170" class="line none">  170         uint16_t <a href="dns_pack.h.html#170">priority</a>;</div><div id="171" class="line none">  171         uint16_t <a href="dns_pack.h.html#171">weight</a>;</div><div id="172" class="line none">  172         uint16_t <a href="dns_pack.h.html#172">port</a>;</div><div id="173" class="line none">  173 } <a href="../../../../include/zephyr/net/net_ip.h.html#486">__packed</a>;</div><div id="174" class="line none">  174 </div><div id="175" class="line none">  175 struct <a href="dns_pack.h.html#175">dns_a_rdata</a> {</div><div id="176" class="line none">  176         uint32_t <a href="dns_pack.h.html#176">address</a>;</div><div id="177" class="line none">  177 } <a href="../../../../include/zephyr/net/net_ip.h.html#486">__packed</a>;</div><div id="178" class="line none">  178 </div><div id="179" class="line none">  179 struct <a href="dns_pack.h.html#179">dns_aaaa_rdata</a> {</div><div id="180" class="line none">  180         uint8_t <a href="dns_pack.h.html#176">address</a>[16];</div><div id="181" class="line none">  181 } <a href="../../../../include/zephyr/net/net_ip.h.html#486">__packed</a>;</div><div id="182" class="line none">  182 </div><div id="183" class="line none">  183 /** It returns the ID field in the DNS msg header       */</div><div id="184" class="line none">  184 static inline int <a href="dns_pack.h.html#184">dns_header_id</a>(uint8_t *header)</div><div id="185" class="line none">  185 {</div><div id="186" class="line none">  186         return <a href="../../../../include/zephyr/net/net_ip.h.html#120">htons</a>(UNALIGNED_GET((uint16_t *)(header)));</div><div id="187" class="line none">  187 }</div><div id="188" class="line none">  188 </div><div id="189" class="line none">  189 /* inline unpack routines are used to unpack data from network</div><div id="190" class="line none">  190  * order to cpu. Similar routines without the unpack prefix are</div><div id="191" class="line none">  191  * used for cpu to network order.</div><div id="192" class="line none">  192  */</div><div id="193" class="line none">  193 static inline int <a href="dns_pack.h.html#193">dns_unpack_header_id</a>(uint8_t *header)</div><div id="194" class="line none">  194 {</div><div id="195" class="line none">  195         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(header)));</div><div id="196" class="line none">  196 }</div><div id="197" class="line none">  197 </div><div id="198" class="line none">  198 /** It returns the QR field in the DNS msg header       */</div><div id="199" class="line none">  199 static inline int <a href="dns_pack.h.html#199">dns_header_qr</a>(uint8_t *header)</div><div id="200" class="line none">  200 {</div><div id="201" class="line none">  201         return ((*(header + 2)) &amp; 0x80) ? 1 : 0;</div><div id="202" class="line none">  202 }</div><div id="203" class="line none">  203 </div><div id="204" class="line none">  204 /** It returns the OPCODE field in the DNS msg header   */</div><div id="205" class="line none">  205 static inline int <a href="dns_pack.h.html#205">dns_header_opcode</a>(uint8_t *header)</div><div id="206" class="line none">  206 {</div><div id="207" class="line none">  207         return ((*(header + 2)) &amp; 0x70) &gt;&gt; 1;</div><div id="208" class="line none">  208 }</div><div id="209" class="line none">  209 </div><div id="210" class="line none">  210 /** It returns the AA field in the DNS msg header       */</div><div id="211" class="line none">  211 static inline int <a href="dns_pack.h.html#211">dns_header_aa</a>(uint8_t *header)</div><div id="212" class="line none">  212 {</div><div id="213" class="line none">  213         return ((*(header + 2)) &amp; 0x04) ? 1 : 0;</div><div id="214" class="line none">  214 }</div><div id="215" class="line none">  215 </div><div id="216" class="line none">  216 /** It returns the TC field in the DNS msg header       */</div><div id="217" class="line none">  217 static inline int <a href="dns_pack.h.html#217">dns_header_tc</a>(uint8_t *header)</div><div id="218" class="line none">  218 {</div><div id="219" class="line none">  219         return ((*(header + 2)) &amp; 0x02) ? 1 : 0;</div><div id="220" class="line none">  220 }</div><div id="221" class="line none">  221 </div><div id="222" class="line none">  222 /** It returns the RD field in the DNS msg header       */</div><div id="223" class="line none">  223 static inline int <a href="dns_pack.h.html#223">dns_header_rd</a>(uint8_t *header)</div><div id="224" class="line none">  224 {</div><div id="225" class="line none">  225         return ((*(header + 2)) &amp; 0x01) ? 1 : 0;</div><div id="226" class="line none">  226 }</div><div id="227" class="line none">  227 </div><div id="228" class="line none">  228 /** It returns the RA field in the DNS msg header       */</div><div id="229" class="line none">  229 static inline int <a href="dns_pack.h.html#229">dns_header_ra</a>(uint8_t *header)</div><div id="230" class="line none">  230 {</div><div id="231" class="line none">  231         return ((*(header + 3)) &amp; 0x80) &gt;&gt; 7;</div><div id="232" class="line none">  232 }</div><div id="233" class="line none">  233 </div><div id="234" class="line none">  234 /** It returns the Z field in the DNS msg header        */</div><div id="235" class="line none">  235 static inline int <a href="dns_pack.h.html#235">dns_header_z</a>(uint8_t *header)</div><div id="236" class="line none">  236 {</div><div id="237" class="line none">  237         return ((*(header + 3)) &amp; 0x70) &gt;&gt; 4;</div><div id="238" class="line none">  238 }</div><div id="239" class="line none">  239 </div><div id="240" class="line none">  240 /** It returns the RCODE field in the DNS msg header    */</div><div id="241" class="line none">  241 static inline int <a href="dns_pack.h.html#241">dns_header_rcode</a>(uint8_t *header)</div><div id="242" class="line none">  242 {</div><div id="243" class="line none">  243         return ((*(header + 3)) &amp; 0x0F);</div><div id="244" class="line none">  244 }</div><div id="245" class="line none">  245 </div><div id="246" class="line none">  246 /** It returns the QDCOUNT field in the DNS msg header  */</div><div id="247" class="line none">  247 static inline int <a href="dns_pack.h.html#247">dns_header_qdcount</a>(uint8_t *header)</div><div id="248" class="line none">  248 {</div><div id="249" class="line none">  249         return <a href="../../../../include/zephyr/net/net_ip.h.html#120">htons</a>(UNALIGNED_GET((uint16_t *)(header + 4)));</div><div id="250" class="line none">  250 }</div><div id="251" class="line none">  251 </div><div id="252" class="line none">  252 static inline int <a href="dns_pack.h.html#252">dns_unpack_header_qdcount</a>(uint8_t *header)</div><div id="253" class="line none">  253 {</div><div id="254" class="line none">  254         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(header + 4)));</div><div id="255" class="line none">  255 }</div><div id="256" class="line none">  256 </div><div id="257" class="line none">  257 /** It returns the ANCOUNT field in the DNS msg header  */</div><div id="258" class="line none">  258 static inline int <a href="dns_pack.h.html#258">dns_header_ancount</a>(uint8_t *header)</div><div id="259" class="line none">  259 {</div><div id="260" class="line none">  260         return <a href="../../../../include/zephyr/net/net_ip.h.html#120">htons</a>(UNALIGNED_GET((uint16_t *)(header + 6)));</div><div id="261" class="line none">  261 }</div><div id="262" class="line none">  262 </div><div id="263" class="line none">  263 static inline int <a href="dns_pack.h.html#263">dns_unpack_header_ancount</a>(uint8_t *header)</div><div id="264" class="line none">  264 {</div><div id="265" class="line none">  265         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(header + 6)));</div><div id="266" class="line none">  266 }</div><div id="267" class="line none">  267 </div><div id="268" class="line none">  268 /** It returns the NSCOUNT field in the DNS msg header  */</div><div id="269" class="line none">  269 static inline int <a href="dns_pack.h.html#269">dns_header_nscount</a>(uint8_t *header)</div><div id="270" class="line none">  270 {</div><div id="271" class="line none">  271         return <a href="../../../../include/zephyr/net/net_ip.h.html#120">htons</a>(UNALIGNED_GET((uint16_t *)(header + 8)));</div><div id="272" class="line none">  272 }</div><div id="273" class="line none">  273 </div><div id="274" class="line none">  274 /** It returns the ARCOUNT field in the DNS msg header  */</div><div id="275" class="line none">  275 static inline int <a href="dns_pack.h.html#275">dns_header_arcount</a>(uint8_t *header)</div><div id="276" class="line none">  276 {</div><div id="277" class="line none">  277         return <a href="../../../../include/zephyr/net/net_ip.h.html#120">htons</a>(UNALIGNED_GET((uint16_t *)(header + 10)));</div><div id="278" class="line none">  278 }</div><div id="279" class="line none">  279 </div><div id="280" class="line none">  280 static inline int <a href="dns_pack.h.html#280">dns_query_qtype</a>(uint8_t *question)</div><div id="281" class="line none">  281 {</div><div id="282" class="line none">  282         return <a href="../../../../include/zephyr/net/net_ip.h.html#120">htons</a>(UNALIGNED_GET((uint16_t *)(question + 0)));</div><div id="283" class="line none">  283 }</div><div id="284" class="line none">  284 </div><div id="285" class="line none">  285 static inline int <a href="dns_pack.h.html#285">dns_unpack_query_qtype</a>(const uint8_t *question)</div><div id="286" class="line none">  286 {</div><div id="287" class="line hit">  287         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(question + 0)));</div><div id="288" class="line hit">  288 }</div><div id="289" class="line none">  289 </div><div id="290" class="line none">  290 static inline int <a href="dns_pack.h.html#290">dns_query_qclass</a>(uint8_t *question)</div><div id="291" class="line none">  291 {</div><div id="292" class="line none">  292         return <a href="../../../../include/zephyr/net/net_ip.h.html#120">htons</a>(UNALIGNED_GET((uint16_t *)(question + 2)));</div><div id="293" class="line none">  293 }</div><div id="294" class="line none">  294 </div><div id="295" class="line none">  295 static inline int <a href="dns_pack.h.html#295">dns_unpack_query_qclass</a>(const uint8_t *question)</div><div id="296" class="line none">  296 {</div><div id="297" class="line hit">  297         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(question + 2)));</div><div id="298" class="line hit">  298 }</div><div id="299" class="line none">  299 </div><div id="300" class="line none">  300 static inline int <a href="dns_pack.h.html#300">dns_answer_type</a>(uint16_t dname_size, uint8_t *answer)</div><div id="301" class="line none">  301 {</div><div id="302" class="line none">  302         /* 4.1.3. Resource record format */</div><div id="303" class="line none">  303         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(answer + dname_size + 0)));</div><div id="304" class="line none">  304 }</div><div id="305" class="line none">  305 </div><div id="306" class="line none">  306 static inline int <a href="dns_pack.h.html#306">dns_answer_class</a>(uint16_t dname_size, uint8_t *answer)</div><div id="307" class="line none">  307 {</div><div id="308" class="line none">  308         /* 4.1.3. Resource record format */</div><div id="309" class="line none">  309         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(answer + dname_size + 2)));</div><div id="310" class="line none">  310 }</div><div id="311" class="line none">  311 </div><div id="312" class="line none">  312 static inline int <a href="dns_pack.h.html#312">dns_answer_ttl</a>(uint16_t dname_size, uint8_t *answer)</div><div id="313" class="line none">  313 {</div><div id="314" class="line none">  314         return <a href="../../../../include/zephyr/net/net_ip.h.html#104">ntohl</a>(UNALIGNED_GET((uint32_t *)(answer + dname_size + 4)));</div><div id="315" class="line none">  315 }</div><div id="316" class="line none">  316 </div><div id="317" class="line none">  317 static inline int <a href="dns_pack.h.html#317">dns_answer_rdlength</a>(uint16_t dname_size,</div><div id="318" class="line none">  318                                              uint8_t *answer)</div><div id="319" class="line none">  319 {</div><div id="320" class="line none">  320         return <a href="../../../../include/zephyr/net/net_ip.h.html#96">ntohs</a>(UNALIGNED_GET((uint16_t *)(answer + dname_size + 8)));</div><div id="321" class="line none">  321 }</div><div id="322" class="line none">  322 </div><div id="323" class="line none">  323 /**</div><div id="324" class="line none">  324  * @brief Packs a QNAME</div><div id="325" class="line none">  325  *</div><div id="326" class="line none">  326  * @param len Bytes used by this function</div><div id="327" class="line none">  327  * @param buf Buffer</div><div id="328" class="line none">  328  * @param sizeof Buffer's size</div><div id="329" class="line none">  329  * @param domain_name Something like www.example.com</div><div id="330" class="line none">  330  * @retval 0 on success</div><div id="331" class="line none">  331  * @retval -ENOMEM if there is no enough space to store the resultant QNAME</div><div id="332" class="line none">  332  * @retval -EINVAL if an invalid parameter was passed as an argument</div><div id="333" class="line none">  333  */</div><div id="334" class="line none">  334 int <a href="dns_pack.c.html#22">dns_msg_pack_qname</a>(uint16_t *<a href="../../../../include/zephyr/net/buf.h.html#96">len</a>, uint8_t *buf, uint16_t <a href="../../../../include/zephyr/net/buf.h.html#99">size</a>,</div><div id="335" class="line none">  335                        const char *domain_name);</div><div id="336" class="line none">  336 </div><div id="337" class="line none">  337 /**</div><div id="338" class="line none">  338  * @brief Unpacks an answer message</div><div id="339" class="line none">  339  *</div><div id="340" class="line none">  340  * @param dns_msg Structure</div><div id="341" class="line none">  341  * @param dname_ptr An index to the previous CNAME. For example for the</div><div id="342" class="line none">  342  *        first answer, ptr must be 0x0c, the DNAME at the question.</div><div id="343" class="line none">  343  * @param ttl TTL answer parameter.</div><div id="344" class="line none">  344  * @param type Answer type parameter.</div><div id="345" class="line none">  345  * @retval 0 on success</div><div id="346" class="line none">  346  * @retval -ENOMEM on error</div><div id="347" class="line none">  347  */</div><div id="348" class="line none">  348 int <a href="dns_pack.c.html#109">dns_unpack_answer</a>(struct <a href="dns_pack.h.html#72">dns_msg_t</a> *dns_msg, int dname_ptr, uint32_t *<a href="../../../../include/zephyr/net/net_ip.h.html#547">ttl</a>,</div><div id="349" class="line none">  349                       enum <a href="dns_pack.h.html#88">dns_rr_type</a> *<a href="../../../../include/zephyr/net/net_ip.h.html#555">type</a>);</div><div id="350" class="line none">  350 </div><div id="351" class="line none">  351 /**</div><div id="352" class="line none">  352  * @brief Unpacks the header's response.</div><div id="353" class="line none">  353  *</div><div id="354" class="line none">  354  * @param msg Structure containing the response.</div><div id="355" class="line none">  355  * @param src_id Transaction id, it must match the id used in the query</div><div id="356" class="line none">  356  *        datagram sent to the DNS server.</div><div id="357" class="line none">  357  * @retval 0 on success</div><div id="358" class="line none">  358  * @retval -ENOMEM if the buffer in msg has no enough space to store the header.</div><div id="359" class="line none">  359  *         The header is always 12 bytes length.</div><div id="360" class="line none">  360  * @retval -EINVAL if the src_id does not match the header's id, or if the</div><div id="361" class="line none">  361  *         header's QR value is not DNS_RESPONSE or if the header's OPCODE</div><div id="362" class="line none">  362  *         value is not DNS_QUERY, or if the header's Z value is not 0 or if</div><div id="363" class="line none">  363  *         the question counter is not 1 or the answer counter is less than 1.</div><div id="364" class="line none">  364  * @retval RFC 1035 RCODEs (&gt; 0) 1 Format error, 2 Server failure, 3 Name Error,</div><div id="365" class="line none">  365  *         4 Not Implemented and 5 Refused.</div><div id="366" class="line none">  366  */</div><div id="367" class="line none">  367 int <a href="dns_pack.c.html#180">dns_unpack_response_header</a>(struct <a href="dns_pack.h.html#72">dns_msg_t</a> *<a href="dns_pack.h.html#73">msg</a>, int src_id);</div><div id="368" class="line none">  368 </div><div id="369" class="line none">  369 /**</div><div id="370" class="line none">  370  * @brief Packs the query message</div><div id="371" class="line none">  371  *</div><div id="372" class="line none">  372  * @param buf Buffer that will contain the resultant query</div><div id="373" class="line none">  373  * @param len Number of bytes used to encode the query</div><div id="374" class="line none">  374  * @param size Buffer size</div><div id="375" class="line none">  375  * @param qname Domain name represented as a sequence of labels.</div><div id="376" class="line none">  376  *        See RFC 1035, 4.1.2. Question section format.</div><div id="377" class="line none">  377  * @param qname_len Number of octets in qname.</div><div id="378" class="line none">  378  * @param id Transaction Identifier</div><div id="379" class="line none">  379  * @param qtype Query type: AA, AAAA. See enum dns_rr_type</div><div id="380" class="line none">  380  * @retval 0 on success</div><div id="381" class="line none">  381  * @retval On error, a negative value is returned.</div><div id="382" class="line none">  382  *         See: dns_msg_pack_query_header and  dns_msg_pack_qname.</div><div id="383" class="line none">  383  */</div><div id="384" class="line none">  384 int <a href="dns_pack.c.html#271">dns_msg_pack_query</a>(uint8_t *buf, uint16_t *<a href="../../../../include/zephyr/net/buf.h.html#96">len</a>, uint16_t <a href="../../../../include/zephyr/net/buf.h.html#99">size</a>,</div><div id="385" class="line none">  385                        uint8_t *qname, uint16_t qname_len, uint16_t <a href="../../../../include/zephyr/net/net_ip.h.html#538">id</a>,</div><div id="386" class="line none">  386                        enum <a href="dns_pack.h.html#88">dns_rr_type</a> qtype);</div><div id="387" class="line none">  387 </div><div id="388" class="line none">  388 /**</div><div id="389" class="line none">  389  * @brief Unpacks the response's query.</div><div id="390" class="line none">  390  *</div><div id="391" class="line none">  391  * @details RFC 1035 states that the response's query comes after the first</div><div id="392" class="line none">  392  *          12 bytes i.e., after the message's header. This function computes</div><div id="393" class="line none">  393  *          the answer_offset field.</div><div id="394" class="line none">  394  *</div><div id="395" class="line none">  395  * @param dns_msg Structure containing the message.</div><div id="396" class="line none">  396  * @retval 0 on success</div><div id="397" class="line none">  397  * @retval -ENOMEM if the null label is not found after traversing the buffer</div><div id="398" class="line none">  398  *         or if QCLASS and QTYPE are not found.</div><div id="399" class="line none">  399  * @retval -EINVAL if QTYPE is not "A" (IPv4) or "AAAA" (IPv6) or if QCLASS</div><div id="400" class="line none">  400  *         is not "IN".</div><div id="401" class="line none">  401  */</div><div id="402" class="line none">  402 int <a href="dns_pack.c.html#318">dns_unpack_response_query</a>(struct <a href="dns_pack.h.html#72">dns_msg_t</a> *dns_msg);</div><div id="403" class="line none">  403 </div><div id="404" class="line none">  404 /**</div><div id="405" class="line none">  405  * @brief Copies the qname from dns_msg to buf</div><div id="406" class="line none">  406  *</div><div id="407" class="line none">  407  * @details This routine implements the algorithm described in RFC 1035, 4.1.4.</div><div id="408" class="line none">  408  *          Message compression to copy the qname (perhaps containing pointers</div><div id="409" class="line none">  409  *          with offset) to the linear buffer buf. Pointers are removed and</div><div id="410" class="line none">  410  *          only the "true" labels are copied.</div><div id="411" class="line none">  411  *</div><div id="412" class="line none">  412  * @param buf Output buffer</div><div id="413" class="line none">  413  * @param len Output buffer's length</div><div id="414" class="line none">  414  * @param size Output buffer's size</div><div id="415" class="line none">  415  * @param dns_msg Structure containing the message</div><div id="416" class="line none">  416  * @param pos QNAME's position in dns_msg-&gt;msg</div><div id="417" class="line none">  417  * @retval 0 on success</div><div id="418" class="line none">  418  * @retval -EINVAL if an invalid parameter was passed as an argument</div><div id="419" class="line none">  419  * @retval -ENOMEM if the label's size is corrupted</div><div id="420" class="line none">  420  */</div><div id="421" class="line none">  421 int <a href="dns_pack.c.html#361">dns_copy_qname</a>(uint8_t *buf, uint16_t *<a href="../../../../include/zephyr/net/buf.h.html#96">len</a>, uint16_t <a href="../../../../include/zephyr/net/buf.h.html#99">size</a>,</div><div id="422" class="line none">  422                    struct <a href="dns_pack.h.html#72">dns_msg_t</a> *dns_msg, uint16_t pos);</div><div id="423" class="line none">  423 </div><div id="424" class="line none">  424 /**</div><div id="425" class="line none">  425  * @brief Unpacks the mDNS query. This is special version for multicast DNS</div><div id="426" class="line none">  426  *        as it skips checks to various fields as described in RFC 6762</div><div id="427" class="line none">  427  *        chapter 18.</div><div id="428" class="line none">  428  *</div><div id="429" class="line none">  429  * @param msg Structure containing the response.</div><div id="430" class="line none">  430  * @param src_id Transaction id, this is returned to the caller.</div><div id="431" class="line none">  431  * @retval 0 on success, &lt;0 if error</div><div id="432" class="line none">  432  * @retval -ENOMEM if the buffer in msg has no enough space to store the header.</div><div id="433" class="line none">  433  *         The header is always 12 bytes length.</div><div id="434" class="line none">  434  * @retval -EINVAL if the src_id does not match the header's id, or if the</div><div id="435" class="line none">  435  *         header's QR value is not DNS_RESPONSE or if the header's OPCODE</div><div id="436" class="line none">  436  *         value is not DNS_QUERY, or if the header's Z value is not 0 or if</div><div id="437" class="line none">  437  *         the question counter is not 1 or the answer counter is less than 1.</div><div id="438" class="line none">  438  * @retval RFC 1035 RCODEs (&gt; 0) 1 Format error, 2 Server failure, 3 Name Error,</div><div id="439" class="line none">  439  *         4 Not Implemented and 5 Refused.</div><div id="440" class="line none">  440  */</div><div id="441" class="line none">  441 int <a href="dns_pack.c.html#421">mdns_unpack_query_header</a>(struct <a href="dns_pack.h.html#72">dns_msg_t</a> *<a href="dns_pack.h.html#73">msg</a>, uint16_t *src_id);</div><div id="442" class="line none">  442 </div><div id="443" class="line none">  443 static inline int <a href="dns_pack.h.html#443">llmnr_unpack_query_header</a>(struct <a href="dns_pack.h.html#72">dns_msg_t</a> *<a href="dns_pack.h.html#73">msg</a>,</div><div id="444" class="line none">  444                                             uint16_t *src_id)</div><div id="445" class="line none">  445 {</div><div id="446" class="line none">  446         return <a href="dns_pack.c.html#421">mdns_unpack_query_header</a>(<a href="dns_pack.h.html#73">msg</a>, src_id);</div><div id="447" class="line none">  447 }</div><div id="448" class="line none">  448 </div><div id="449" class="line none">  449 /**</div><div id="450" class="line none">  450  * @brief Unpacks the query.</div><div id="451" class="line none">  451  *</div><div id="452" class="line none">  452  * @param dns_msg Structure containing the message.</div><div id="453" class="line none">  453  * @param buf Result buf</div><div id="454" class="line none">  454  * @param qtype Query type is returned to caller</div><div id="455" class="line none">  455  * @param qclass Query class is returned to caller</div><div id="456" class="line none">  456  * @retval 0 on success</div><div id="457" class="line none">  457  * @retval -ENOMEM if the null label is not found after traversing the buffer</div><div id="458" class="line none">  458  *         or if QCLASS and QTYPE are not found.</div><div id="459" class="line none">  459  * @retval -EINVAL if QTYPE is not "A" (IPv4) or "AAAA" (IPv6) or if QCLASS</div><div id="460" class="line none">  460  *         is not "IN".</div><div id="461" class="line none">  461  */</div><div id="462" class="line none">  462 int <a href="dns_pack.c.html#567">dns_unpack_query</a>(struct <a href="dns_pack.h.html#72">dns_msg_t</a> *dns_msg, struct <a href="../../../../include/zephyr/net/buf.h.html#1004">net_buf</a> *buf,</div><div id="463" class="line none">  463                      enum <a href="dns_pack.h.html#88">dns_rr_type</a> *qtype,</div><div id="464" class="line none">  464                      enum <a href="dns_pack.h.html#106">dns_class</a> *qclass);</div><div id="465" class="line none">  465 </div><div id="466" class="line none">  466 /**</div><div id="467" class="line none">  467  * @brief Map query type number to a string.</div><div id="468" class="line none">  468  *</div><div id="469" class="line none">  469  * @param qtype Query type</div><div id="470" class="line none">  470  *</div><div id="471" class="line none">  471  * @return Printable query type name.</div><div id="472" class="line none">  472  */</div><div id="473" class="line none">  473 const char *<a href="dns_pack.c.html#543">dns_qtype_to_str</a>(enum <a href="dns_pack.h.html#88">dns_rr_type</a> qtype);</div><div id="474" class="line none">  474 </div><div id="475" class="line none">  475 #endif</div>
</div>
</body>
</html>
