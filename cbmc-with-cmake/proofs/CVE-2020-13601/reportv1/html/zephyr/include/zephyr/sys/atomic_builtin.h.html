
<html>
<head>
<title>zephyr/include/zephyr/sys/atomic_builtin.h</title>
<link rel="stylesheet" type="text/css" href="../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /* atomic operations */</div><div id="2" class="line none">    2 </div><div id="3" class="line none">    3 /*</div><div id="4" class="line none">    4  * Copyright (c) 1997-2015, Wind River Systems, Inc.</div><div id="5" class="line none">    5  * Copyright (c) 2023 Nordic Semiconductor ASA</div><div id="6" class="line none">    6  *</div><div id="7" class="line none">    7  * SPDX-License-Identifier: Apache-2.0</div><div id="8" class="line none">    8  */</div><div id="9" class="line none">    9 </div><div id="10" class="line none">   10 #ifndef <a href="atomic_builtin.h.html#11">ZEPHYR_INCLUDE_SYS_ATOMIC_BUILTIN_H_</a></div><div id="11" class="line none">   11 #define <a href="atomic_builtin.h.html#11">ZEPHYR_INCLUDE_SYS_ATOMIC_BUILTIN_H_</a></div><div id="12" class="line none">   12 </div><div id="13" class="line none">   13 #include &lt;stdbool.h&gt;</div><div id="14" class="line none">   14 #include &lt;stddef.h&gt;</div><div id="15" class="line none">   15 #include &lt;zephyr/sys/atomic_types.h&gt;</div><div id="16" class="line none">   16 </div><div id="17" class="line none">   17 #ifdef __cplusplus</div><div id="18" class="line none">   18 extern "C" {</div><div id="19" class="line none">   19 #endif</div><div id="20" class="line none">   20 </div><div id="21" class="line none">   21 /* Included from &lt;atomic.h&gt; */</div><div id="22" class="line none">   22 </div><div id="23" class="line none">   23 static inline bool <a href="atomic_builtin.h.html#23">atomic_cas</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> old_value,</div><div id="24" class="line none">   24                           <a href="atomic_types.h.html#16">atomic_val_t</a> new_value)</div><div id="25" class="line none">   25 {</div><div id="26" class="line none">   26         return __atomic_compare_exchange_n(target, &amp;old_value, new_value,</div><div id="27" class="line none">   27                                            0, __ATOMIC_SEQ_CST,</div><div id="28" class="line none">   28                                            __ATOMIC_SEQ_CST);</div><div id="29" class="line none">   29 }</div><div id="30" class="line none">   30 </div><div id="31" class="line none">   31 static inline bool <a href="atomic_builtin.h.html#31">atomic_ptr_cas</a>(<a href="atomic_types.h.html#17">atomic_ptr_t</a> *target, <a href="atomic_types.h.html#18">atomic_ptr_val_t</a> old_value,</div><div id="32" class="line none">   32                                   <a href="atomic_types.h.html#18">atomic_ptr_val_t</a> new_value)</div><div id="33" class="line none">   33 {</div><div id="34" class="line none">   34         return __atomic_compare_exchange_n(target, &amp;old_value, new_value,</div><div id="35" class="line none">   35                                            0, __ATOMIC_SEQ_CST,</div><div id="36" class="line none">   36                                            __ATOMIC_SEQ_CST);</div><div id="37" class="line none">   37 }</div><div id="38" class="line none">   38 </div><div id="39" class="line none">   39 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#39">atomic_add</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> value)</div><div id="40" class="line none">   40 {</div><div id="41" class="line none">   41         return __atomic_fetch_add(target, value, __ATOMIC_SEQ_CST);</div><div id="42" class="line none">   42 }</div><div id="43" class="line none">   43 </div><div id="44" class="line none">   44 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#44">atomic_sub</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> value)</div><div id="45" class="line none">   45 {</div><div id="46" class="line none">   46         return __atomic_fetch_sub(target, value, __ATOMIC_SEQ_CST);</div><div id="47" class="line none">   47 }</div><div id="48" class="line none">   48 </div><div id="49" class="line none">   49 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#49">atomic_inc</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target)</div><div id="50" class="line none">   50 {</div><div id="51" class="line none">   51         return <a href="atomic_builtin.h.html#39">atomic_add</a>(target, 1);</div><div id="52" class="line none">   52 }</div><div id="53" class="line none">   53 </div><div id="54" class="line none">   54 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#54">atomic_dec</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target)</div><div id="55" class="line none">   55 {</div><div id="56" class="line none">   56         return <a href="atomic_builtin.h.html#44">atomic_sub</a>(target, 1);</div><div id="57" class="line none">   57 }</div><div id="58" class="line none">   58 </div><div id="59" class="line none">   59 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#59">atomic_get</a>(const <a href="atomic_types.h.html#15">atomic_t</a> *target)</div><div id="60" class="line none">   60 {</div><div id="61" class="line none">   61         return __atomic_load_n(target, __ATOMIC_SEQ_CST);</div><div id="62" class="line none">   62 }</div><div id="63" class="line none">   63 </div><div id="64" class="line none">   64 static inline <a href="atomic_types.h.html#18">atomic_ptr_val_t</a> <a href="atomic_builtin.h.html#64">atomic_ptr_get</a>(const <a href="atomic_types.h.html#17">atomic_ptr_t</a> *target)</div><div id="65" class="line none">   65 {</div><div id="66" class="line none">   66         return __atomic_load_n(target, __ATOMIC_SEQ_CST);</div><div id="67" class="line none">   67 }</div><div id="68" class="line none">   68 </div><div id="69" class="line none">   69 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#69">atomic_set</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> value)</div><div id="70" class="line none">   70 {</div><div id="71" class="line none">   71         /* This builtin, as described by Intel, is not a traditional</div><div id="72" class="line none">   72          * test-and-set operation, but rather an atomic exchange operation. It</div><div id="73" class="line none">   73          * writes value into *ptr, and returns the previous contents of *ptr.</div><div id="74" class="line none">   74          */</div><div id="75" class="line none">   75         return __atomic_exchange_n(target, value, __ATOMIC_SEQ_CST);</div><div id="76" class="line none">   76 }</div><div id="77" class="line none">   77 </div><div id="78" class="line none">   78 static inline <a href="atomic_types.h.html#18">atomic_ptr_val_t</a> <a href="atomic_builtin.h.html#78">atomic_ptr_set</a>(<a href="atomic_types.h.html#17">atomic_ptr_t</a> *target, <a href="atomic_types.h.html#18">atomic_ptr_val_t</a> value)</div><div id="79" class="line none">   79 {</div><div id="80" class="line none">   80         return __atomic_exchange_n(target, value, __ATOMIC_SEQ_CST);</div><div id="81" class="line none">   81 }</div><div id="82" class="line none">   82 </div><div id="83" class="line none">   83 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#83">atomic_clear</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target)</div><div id="84" class="line none">   84 {</div><div id="85" class="line none">   85         return <a href="atomic_builtin.h.html#69">atomic_set</a>(target, 0);</div><div id="86" class="line none">   86 }</div><div id="87" class="line none">   87 </div><div id="88" class="line none">   88 static inline <a href="atomic_types.h.html#18">atomic_ptr_val_t</a> <a href="atomic_builtin.h.html#88">atomic_ptr_clear</a>(<a href="atomic_types.h.html#17">atomic_ptr_t</a> *target)</div><div id="89" class="line none">   89 {</div><div id="90" class="line none">   90         return <a href="atomic_builtin.h.html#78">atomic_ptr_set</a>(target, NULL);</div><div id="91" class="line none">   91 }</div><div id="92" class="line none">   92 </div><div id="93" class="line none">   93 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#93">atomic_or</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> value)</div><div id="94" class="line none">   94 {</div><div id="95" class="line none">   95         return __atomic_fetch_or(target, value, __ATOMIC_SEQ_CST);</div><div id="96" class="line none">   96 }</div><div id="97" class="line none">   97 </div><div id="98" class="line none">   98 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#98">atomic_xor</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> value)</div><div id="99" class="line none">   99 {</div><div id="100" class="line none">  100         return __atomic_fetch_xor(target, value, __ATOMIC_SEQ_CST);</div><div id="101" class="line none">  101 }</div><div id="102" class="line none">  102 </div><div id="103" class="line none">  103 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#103">atomic_and</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> value)</div><div id="104" class="line none">  104 {</div><div id="105" class="line none">  105         return __atomic_fetch_and(target, value, __ATOMIC_SEQ_CST);</div><div id="106" class="line none">  106 }</div><div id="107" class="line none">  107 </div><div id="108" class="line none">  108 static inline <a href="atomic_types.h.html#16">atomic_val_t</a> <a href="atomic_builtin.h.html#108">atomic_nand</a>(<a href="atomic_types.h.html#15">atomic_t</a> *target, <a href="atomic_types.h.html#16">atomic_val_t</a> value)</div><div id="109" class="line none">  109 {</div><div id="110" class="line none">  110         return __atomic_fetch_nand(target, value, __ATOMIC_SEQ_CST);</div><div id="111" class="line none">  111 }</div><div id="112" class="line none">  112 </div><div id="113" class="line none">  113 #ifdef __cplusplus</div><div id="114" class="line none">  114 }</div><div id="115" class="line none">  115 #endif</div><div id="116" class="line none">  116 </div><div id="117" class="line none">  117 #endif /* ZEPHYR_INCLUDE_SYS_ATOMIC_BUILTIN_H_ */</div>
</div>
</body>
</html>
