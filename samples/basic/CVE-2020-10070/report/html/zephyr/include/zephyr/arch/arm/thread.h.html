
<html>
<head>
<title>zephyr/include/zephyr/arch/arm/thread.h</title>
<link rel="stylesheet" type="text/css" href="../../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2017 Intel Corporation</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * SPDX-License-Identifier: Apache-2.0</div><div id="5" class="line none">    5  */</div><div id="6" class="line none">    6 </div><div id="7" class="line none">    7 /**</div><div id="8" class="line none">    8  * @file</div><div id="9" class="line none">    9  * @brief Per-arch thread definition</div><div id="10" class="line none">   10  *</div><div id="11" class="line none">   11  * This file contains definitions for</div><div id="12" class="line none">   12  *</div><div id="13" class="line none">   13  *  struct _thread_arch</div><div id="14" class="line none">   14  *  struct _callee_saved</div><div id="15" class="line none">   15   *</div><div id="16" class="line none">   16  * necessary to instantiate instances of struct k_thread.</div><div id="17" class="line none">   17  */</div><div id="18" class="line none">   18 </div><div id="19" class="line none">   19 #ifndef <a href="thread.h.html#20">ZEPHYR_INCLUDE_ARCH_ARM_THREAD_H_</a></div><div id="20" class="line none">   20 #define <a href="thread.h.html#20">ZEPHYR_INCLUDE_ARCH_ARM_THREAD_H_</a></div><div id="21" class="line none">   21 </div><div id="22" class="line none">   22 #ifndef _ASMLANGUAGE</div><div id="23" class="line none">   23 #include &lt;zephyr/types.h&gt;</div><div id="24" class="line none">   24 </div><div id="25" class="line none">   25 struct <a href="thread.h.html#25">_callee_saved</a> {</div><div id="26" class="line none">   26         uint32_t <a href="thread.h.html#26">v1</a>;  /* r4 */</div><div id="27" class="line none">   27         uint32_t <a href="thread.h.html#27">v2</a>;  /* r5 */</div><div id="28" class="line none">   28         uint32_t <a href="thread.h.html#28">v3</a>;  /* r6 */</div><div id="29" class="line none">   29         uint32_t <a href="thread.h.html#29">v4</a>;  /* r7 */</div><div id="30" class="line none">   30         uint32_t <a href="thread.h.html#30">v5</a>;  /* r8 */</div><div id="31" class="line none">   31         uint32_t <a href="thread.h.html#31">v6</a>;  /* r9 */</div><div id="32" class="line none">   32         uint32_t <a href="thread.h.html#32">v7</a>;  /* r10 */</div><div id="33" class="line none">   33         uint32_t <a href="thread.h.html#33">v8</a>;  /* r11 */</div><div id="34" class="line none">   34         uint32_t <a href="thread.h.html#34">psp</a>; /* r13 */</div><div id="35" class="line none">   35 #ifdef CONFIG_USE_SWITCH</div><div id="36" class="line none">   36         uint32_t <a href="thread.h.html#36">lr</a>;  /* lr */</div><div id="37" class="line none">   37 #endif</div><div id="38" class="line none">   38 };</div><div id="39" class="line none">   39 </div><div id="40" class="line none">   40 typedef struct <a href="thread.h.html#25">_callee_saved</a> <a href="thread.h.html#40">_callee_saved_t</a>;</div><div id="41" class="line none">   41 </div><div id="42" class="line none">   42 #if defined(CONFIG_FPU) &amp;&amp; defined(CONFIG_FPU_SHARING)</div><div id="43" class="line none">   43 struct <a href="thread.h.html#43">_preempt_float</a> {</div><div id="44" class="line none">   44         float  <a href="thread.h.html#44">s16</a>;</div><div id="45" class="line none">   45         float  <a href="thread.h.html#45">s17</a>;</div><div id="46" class="line none">   46         float  <a href="thread.h.html#46">s18</a>;</div><div id="47" class="line none">   47         float  <a href="thread.h.html#47">s19</a>;</div><div id="48" class="line none">   48         float  <a href="thread.h.html#48">s20</a>;</div><div id="49" class="line none">   49         float  <a href="thread.h.html#49">s21</a>;</div><div id="50" class="line none">   50         float  <a href="thread.h.html#50">s22</a>;</div><div id="51" class="line none">   51         float  <a href="thread.h.html#51">s23</a>;</div><div id="52" class="line none">   52         float  <a href="thread.h.html#52">s24</a>;</div><div id="53" class="line none">   53         float  <a href="thread.h.html#53">s25</a>;</div><div id="54" class="line none">   54         float  <a href="thread.h.html#54">s26</a>;</div><div id="55" class="line none">   55         float  <a href="thread.h.html#55">s27</a>;</div><div id="56" class="line none">   56         float  <a href="thread.h.html#56">s28</a>;</div><div id="57" class="line none">   57         float  <a href="thread.h.html#57">s29</a>;</div><div id="58" class="line none">   58         float  <a href="thread.h.html#58">s30</a>;</div><div id="59" class="line none">   59         float  <a href="thread.h.html#59">s31</a>;</div><div id="60" class="line none">   60 };</div><div id="61" class="line none">   61 #endif</div><div id="62" class="line none">   62 </div><div id="63" class="line none">   63 struct <a href="thread.h.html#63">_thread_arch</a> {</div><div id="64" class="line none">   64 </div><div id="65" class="line none">   65         /* interrupt locking key */</div><div id="66" class="line none">   66         uint32_t <a href="thread.h.html#66">basepri</a>;</div><div id="67" class="line none">   67 </div><div id="68" class="line none">   68         /* r0 in stack frame cannot be written to reliably */</div><div id="69" class="line none">   69         uint32_t <a href="thread.h.html#69">swap_return_value</a>;</div><div id="70" class="line none">   70 </div><div id="71" class="line none">   71 #if defined(CONFIG_FPU) &amp;&amp; defined(CONFIG_FPU_SHARING)</div><div id="72" class="line none">   72         /*</div><div id="73" class="line none">   73          * No cooperative floating point register set structure exists for</div><div id="74" class="line none">   74          * the Cortex-M as it automatically saves the necessary registers</div><div id="75" class="line none">   75          * in its exception stack frame.</div><div id="76" class="line none">   76          */</div><div id="77" class="line none">   77         struct <a href="thread.h.html#43">_preempt_float</a>  <a href="thread.h.html#77">preempt_float</a>;</div><div id="78" class="line none">   78 #endif</div><div id="79" class="line none">   79 </div><div id="80" class="line none">   80 #if defined(CONFIG_CPU_AARCH32_CORTEX_A) || defined(CONFIG_CPU_AARCH32_CORTEX_R)</div><div id="81" class="line none">   81         int8_t <a href="thread.h.html#81">exception_depth</a>;</div><div id="82" class="line none">   82 #endif</div><div id="83" class="line none">   83 </div><div id="84" class="line none">   84 #if defined(CONFIG_ARM_STORE_EXC_RETURN) || defined(CONFIG_USERSPACE)</div><div id="85" class="line none">   85         /*</div><div id="86" class="line none">   86          * Status variable holding several thread status flags</div><div id="87" class="line none">   87          * as follows:</div><div id="88" class="line none">   88          *</div><div id="89" class="line none">   89          * byte 0</div><div id="90" class="line none">   90          * +-bits 4-7-----bit-3----------bit-2--------bit-1---+----bit-0------+</div><div id="91" class="line none">   91          * :          |             |              |          |               |</div><div id="92" class="line none">   92          * : reserved |&lt;Guard FLOAT&gt;|   reserved   | reserved |  &lt;priv mode&gt;  |</div><div id="93" class="line none">   93          * :   bits   |             |              |          | CONTROL.nPRIV |</div><div id="94" class="line none">   94          * +------------------------------------------------------------------+</div><div id="95" class="line none">   95          *</div><div id="96" class="line none">   96          * byte 1</div><div id="97" class="line none">   97          * +----------------------------bits 8-15-----------------------------+</div><div id="98" class="line none">   98          * :              Least significant byte of EXC_RETURN                |</div><div id="99" class="line none">   99          * : bit 15| bit 14| bit 13 | bit 12| bit 11 | bit 10 | bit 9 | bit 8 |</div><div id="100" class="line none">  100          * :  Res  |   S   |  DCRS  | FType |  Mode  | SPSel  |  Res  |  ES   |</div><div id="101" class="line none">  101          * +------------------------------------------------------------------+</div><div id="102" class="line none">  102          *</div><div id="103" class="line none">  103          * Bit 0: thread's current privileged mode (Supervisor or User mode)</div><div id="104" class="line none">  104          *        Mirrors CONTROL.nPRIV flag.</div><div id="105" class="line none">  105          * Bit 2: Deprecated in favor of FType. Note: FType = !CONTROL.FPCA.</div><div id="106" class="line none">  106          *        indicating whether the thread has an active FP context.</div><div id="107" class="line none">  107          *        Mirrors CONTROL.FPCA flag.</div><div id="108" class="line none">  108          * Bit 3: indicating whether the thread is applying the long (FLOAT)</div><div id="109" class="line none">  109          *        or the default MPU stack guard size.</div><div id="110" class="line none">  110          *</div><div id="111" class="line none">  111          * Bits 8-15: Least significant octet of the EXC_RETURN value when a</div><div id="112" class="line none">  112          *            thread is switched-out. The value is copied from LR when</div><div id="113" class="line none">  113          *            entering the PendSV handler. When the thread is</div><div id="114" class="line none">  114          *            switched in again, the value is restored to LR before</div><div id="115" class="line none">  115          *            exiting the PendSV handler.</div><div id="116" class="line none">  116          */</div><div id="117" class="line none">  117         union {</div><div id="118" class="line none">  118                 uint32_t <a href="thread.h.html#118">mode</a>;</div><div id="119" class="line none">  119 </div><div id="120" class="line none">  120 #if defined(CONFIG_ARM_STORE_EXC_RETURN)</div><div id="121" class="line none">  121                 struct {</div><div id="122" class="line none">  122                         uint8_t <a href="thread.h.html#122">mode_bits</a>;</div><div id="123" class="line none">  123                         uint8_t <a href="thread.h.html#123">mode_exc_return</a>;</div><div id="124" class="line none">  124                         uint16_t <a href="thread.h.html#124">mode_reserved2</a>;</div><div id="125" class="line none">  125                 };</div><div id="126" class="line none">  126 #endif</div><div id="127" class="line none">  127         };</div><div id="128" class="line none">  128 </div><div id="129" class="line none">  129 #if defined(CONFIG_USERSPACE)</div><div id="130" class="line none">  130         uint32_t <a href="thread.h.html#130">priv_stack_start</a>;</div><div id="131" class="line none">  131 #if defined(CONFIG_CPU_AARCH32_CORTEX_R)</div><div id="132" class="line none">  132         uint32_t <a href="thread.h.html#132">priv_stack_end</a>;</div><div id="133" class="line none">  133         uint32_t <a href="thread.h.html#133">sp_usr</a>;</div><div id="134" class="line none">  134 #endif</div><div id="135" class="line none">  135 #endif</div><div id="136" class="line none">  136 #endif</div><div id="137" class="line none">  137 };</div><div id="138" class="line none">  138 </div><div id="139" class="line none">  139 #if defined(CONFIG_FPU_SHARING) &amp;&amp; defined(CONFIG_MPU_STACK_GUARD)</div><div id="140" class="line none">  140 #define <a href="thread.h.html#140">Z_ARM_MODE_MPU_GUARD_FLOAT_Msk</a> (1 &lt;&lt; 3)</div><div id="141" class="line none">  141 #endif</div><div id="142" class="line none">  142 typedef struct <a href="thread.h.html#63">_thread_arch</a> <a href="thread.h.html#142">_thread_arch_t</a>;</div><div id="143" class="line none">  143 </div><div id="144" class="line none">  144 #endif /* _ASMLANGUAGE */</div><div id="145" class="line none">  145 </div><div id="146" class="line none">  146 #endif /* ZEPHYR_INCLUDE_ARCH_ARM_THREAD_H_ */</div>
</div>
</body>
</html>
