
<html>
<head>
<title>zephyr/include/zephyr/logging/log_instance.h</title>
<link rel="stylesheet" type="text/css" href="../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2018 Nordic Semiconductor ASA</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * SPDX-License-Identifier: Apache-2.0</div><div id="5" class="line none">    5  */</div><div id="6" class="line none">    6 #ifndef <a href="log_instance.h.html#7">ZEPHYR_INCLUDE_LOGGING_LOG_INSTANCE_H_</a></div><div id="7" class="line none">    7 #define <a href="log_instance.h.html#7">ZEPHYR_INCLUDE_LOGGING_LOG_INSTANCE_H_</a></div><div id="8" class="line none">    8 </div><div id="9" class="line none">    9 #include &lt;zephyr/types.h&gt;</div><div id="10" class="line none">   10 #include &lt;zephyr/sys/iterable_sections.h&gt;</div><div id="11" class="line none">   11 </div><div id="12" class="line none">   12 #ifdef __cplusplus</div><div id="13" class="line none">   13 extern "C" {</div><div id="14" class="line none">   14 #endif</div><div id="15" class="line none">   15 </div><div id="16" class="line none">   16 /** @brief Constant data associated with the source of log messages. */</div><div id="17" class="line none">   17 struct <a href="log_instance.h.html#17">log_source_const_data</a> {</div><div id="18" class="line none">   18         const char *<a href="../kernel.h.html#4006">name</a>;</div><div id="19" class="line none">   19         uint8_t <a href="log_instance.h.html#19">level</a>;</div><div id="20" class="line none">   20 #ifdef CONFIG_NIOS2</div><div id="21" class="line none">   21         /* Workaround alert! Dummy data to ensure that structure is &gt;8 bytes.</div><div id="22" class="line none">   22          * Nios2 uses global pointer register for structures &lt;=8 bytes and</div><div id="23" class="line none">   23          * apparently does not handle well variables placed in custom sections.</div><div id="24" class="line none">   24          */</div><div id="25" class="line none">   25         uint32_t <a href="../kernel/thread.h.html#246">dummy</a>;</div><div id="26" class="line none">   26 #endif</div><div id="27" class="line none">   27 };</div><div id="28" class="line none">   28 </div><div id="29" class="line none">   29 /** @brief Dynamic data associated with the source of log messages. */</div><div id="30" class="line none">   30 struct <a href="log_instance.h.html#30">log_source_dynamic_data</a> {</div><div id="31" class="line none">   31         uint32_t <a href="log_instance.h.html#31">filters</a>;</div><div id="32" class="line none">   32 #ifdef CONFIG_NIOS2</div><div id="33" class="line none">   33         /* Workaround alert! Dummy data to ensure that structure is &gt;8 bytes.</div><div id="34" class="line none">   34          * Nios2 uses global pointer register for structures &lt;=8 bytes and</div><div id="35" class="line none">   35          * apparently does not handle well variables placed in custom sections.</div><div id="36" class="line none">   36          */</div><div id="37" class="line none">   37         uint32_t <a href="../kernel/thread.h.html#246">dummy</a>[2];</div><div id="38" class="line none">   38 #endif</div><div id="39" class="line none">   39 #if defined(CONFIG_64BIT)</div><div id="40" class="line none">   40         /* Workaround: Ensure that structure size is a multiple of 8 bytes. */</div><div id="41" class="line none">   41         uint32_t <a href="log_instance.h.html#41">dummy_64</a>;</div><div id="42" class="line none">   42 #endif</div><div id="43" class="line none">   43 };</div><div id="44" class="line none">   44 </div><div id="45" class="line none">   45 /** @internal</div><div id="46" class="line none">   46  *</div><div id="47" class="line none">   47  * Creates name of variable and section for constant log data.</div><div id="48" class="line none">   48  *</div><div id="49" class="line none">   49  *  @param _name Name.</div><div id="50" class="line none">   50  */</div><div id="51" class="line none">   51 #define <a href="log_instance.h.html#51">Z_LOG_ITEM_CONST_DATA</a>(_name) UTIL_CAT(log_const_, _name)</div><div id="52" class="line none">   52 </div><div id="53" class="line none">   53 /** @internal</div><div id="54" class="line none">   54  *</div><div id="55" class="line none">   55  * Create static logging instance in read only memory.</div><div id="56" class="line none">   56  *</div><div id="57" class="line none">   57  * @param _name name of the module. With added prefix forms name of variable and</div><div id="58" class="line none">   58  * memory section.</div><div id="59" class="line none">   59  *</div><div id="60" class="line none">   60  * @param _str_name Name of the module that will be used when message is formatted.</div><div id="61" class="line none">   61  *</div><div id="62" class="line none">   62  * @param _level Messages up to this level are compiled in.</div><div id="63" class="line none">   63  */</div><div id="64" class="line none">   64 #define <a href="log_instance.h.html#64">Z_LOG_CONST_ITEM_REGISTER</a>(_name, _str_name, _level)                    \</div><div id="65" class="line none">   65         const STRUCT_SECTION_ITERABLE_ALTERNATE(log_const,                     \</div><div id="66" class="line none">   66                 <a href="log_instance.h.html#17">log_source_const_data</a>,                                         \</div><div id="67" class="line none">   67                 <a href="log_instance.h.html#51">Z_LOG_ITEM_CONST_DATA</a>(_name)) =                                \</div><div id="68" class="line none">   68         {                                                                      \</div><div id="69" class="line none">   69                 .<a href="../kernel.h.html#4006">name</a> = _str_name,                                             \</div><div id="70" class="line none">   70                 .<a href="log_instance.h.html#19">level</a>  = (_level),                                            \</div><div id="71" class="line none">   71         }</div><div id="72" class="line none">   72 </div><div id="73" class="line none">   73 /** @brief Initialize pointer to logger instance with explicitly provided object.</div><div id="74" class="line none">   74  *</div><div id="75" class="line none">   75  * Macro can be used to initialized a pointer with object that is not unique to</div><div id="76" class="line none">   76  * the given instance, thus not created with @ref LOG_INSTANCE_REGISTER.</div><div id="77" class="line none">   77  *</div><div id="78" class="line none">   78  * @param _name Name of the structure element for holding logging object.</div><div id="79" class="line none">   79  * @param _object Pointer to a logging instance object.</div><div id="80" class="line none">   80  */</div><div id="81" class="line none">   81 #define <a href="log_instance.h.html#81">LOG_OBJECT_PTR_INIT</a>(_name, _object) \</div><div id="82" class="line none">   82         IF_ENABLED(CONFIG_LOG, (._name = _object,))</div><div id="83" class="line none">   83 </div><div id="84" class="line none">   84 /** @internal</div><div id="85" class="line none">   85  *</div><div id="86" class="line none">   86  * Create a name for which contains module and instance names.</div><div id="87" class="line none">   87  */</div><div id="88" class="line none">   88 #define <a href="log_instance.h.html#88">Z_LOG_INSTANCE_FULL_NAME</a>(_module_name, _inst_name) \</div><div id="89" class="line none">   89         UTIL_CAT(_module_name, UTIL_CAT(_, _inst_name))</div><div id="90" class="line none">   90 </div><div id="91" class="line none">   91 /** @internal</div><div id="92" class="line none">   92  *</div><div id="93" class="line none">   93  * Returns a pointer associated with given logging instance. When runtime filtering</div><div id="94" class="line none">   94  * is enabled then dynamic instance is returned.</div><div id="95" class="line none">   95  *</div><div id="96" class="line none">   96  * @param _name Name of the instance.</div><div id="97" class="line none">   97  *</div><div id="98" class="line none">   98  * @return Pointer to the instance object (static or dynamic).</div><div id="99" class="line none">   99  */</div><div id="100" class="line none">  100 #define <a href="log_instance.h.html#100">Z_LOG_OBJECT_PTR</a>(_name) \</div><div id="101" class="line none">  101                 COND_CODE_1(CONFIG_LOG_RUNTIME_FILTERING, \</div><div id="102" class="line none">  102                         (&amp;<a href="log_core.h.html#478">LOG_ITEM_DYNAMIC_DATA</a>(_name)), \</div><div id="103" class="line none">  103                         (&amp;<a href="log_instance.h.html#51">Z_LOG_ITEM_CONST_DATA</a>(_name))) \</div><div id="104" class="line none">  104 </div><div id="105" class="line none">  105 /** @brief Get pointer to a logging instance.</div><div id="106" class="line none">  106  *</div><div id="107" class="line none">  107  * Instance is identified by @p _module_name and @p _inst_name.</div><div id="108" class="line none">  108  *</div><div id="109" class="line none">  109  * @param _module_name Module name.</div><div id="110" class="line none">  110  * @param _inst_name Instance name.</div><div id="111" class="line none">  111  *</div><div id="112" class="line none">  112  * @return Pointer to a logging instance.</div><div id="113" class="line none">  113  */</div><div id="114" class="line none">  114 #define <a href="log_instance.h.html#114">LOG_INSTANCE_PTR</a>(_module_name, _inst_name) \</div><div id="115" class="line none">  115         <a href="log_instance.h.html#100">Z_LOG_OBJECT_PTR</a>(<a href="log_instance.h.html#88">Z_LOG_INSTANCE_FULL_NAME</a>(_module_name, _inst_name))</div><div id="116" class="line none">  116 </div><div id="117" class="line none">  117 /** @brief Macro for initializing a pointer to the logger instance.</div><div id="118" class="line none">  118  *</div><div id="119" class="line none">  119  * @p _module_name and @p _inst_name are concatenated to form a name of the object.</div><div id="120" class="line none">  120  *</div><div id="121" class="line none">  121  * Macro is intended to be used in user structure initializer to initialize a field</div><div id="122" class="line none">  122  * in the structure that holds pointer to the logging instance. Structure field</div><div id="123" class="line none">  123  * should be declared using @p LOG_INSTANCE_PTR_DECLARE.</div><div id="124" class="line none">  124  *</div><div id="125" class="line none">  125  * @param _name Name of a structure element that have a pointer to logging instance object.</div><div id="126" class="line none">  126  * @param _module_name Module name.</div><div id="127" class="line none">  127  * @param _inst_name Instance name.</div><div id="128" class="line none">  128  */</div><div id="129" class="line none">  129 #define <a href="log_instance.h.html#129">LOG_INSTANCE_PTR_INIT</a>(_name, _module_name, _inst_name)     \</div><div id="130" class="line none">  130         <a href="log_instance.h.html#81">LOG_OBJECT_PTR_INIT</a>(_name, <a href="log_instance.h.html#114">LOG_INSTANCE_PTR</a>(_module_name, _inst_name))</div><div id="131" class="line none">  131 </div><div id="132" class="line none">  132 #define <a href="log_instance.h.html#132">Z_LOG_INSTANCE_STRUCT</a> \</div><div id="133" class="line none">  133         COND_CODE_1(CONFIG_LOG_RUNTIME_FILTERING, \</div><div id="134" class="line none">  134                     (struct <a href="log_instance.h.html#30">log_source_dynamic_data</a>), \</div><div id="135" class="line none">  135                     (const struct <a href="log_instance.h.html#17">log_source_const_data</a>))</div><div id="136" class="line none">  136 </div><div id="137" class="line none">  137 /**</div><div id="138" class="line none">  138  * @brief Declare a logger instance pointer in the module structure.</div><div id="139" class="line none">  139  *</div><div id="140" class="line none">  140  * If logging is disabled then element in the structure is still declared to avoid</div><div id="141" class="line none">  141  * compilation issues. If compiler supports zero length arrays then it is utilized</div><div id="142" class="line none">  142  * to not use any space, else a byte array is created.</div><div id="143" class="line none">  143  *</div><div id="144" class="line none">  144  * @param _name Name of a structure element that will have a pointer to logging</div><div id="145" class="line none">  145  * instance object.</div><div id="146" class="line none">  146  */</div><div id="147" class="line none">  147 #define <a href="log_instance.h.html#147">LOG_INSTANCE_PTR_DECLARE</a>(_name) \</div><div id="148" class="line none">  148         COND_CODE_1(CONFIG_LOG, (<a href="log_instance.h.html#132">Z_LOG_INSTANCE_STRUCT</a> * _name), \</div><div id="149" class="line none">  149                                 (int _name[TOOLCHAIN_HAS_ZLA ? 0 : 1]))</div><div id="150" class="line none">  150 </div><div id="151" class="line none">  151 #define <a href="log_instance.h.html#151">Z_LOG_RUNTIME_INSTANCE_REGISTER</a>(_module_name, _inst_name) \</div><div id="152" class="line none">  152         STRUCT_SECTION_ITERABLE_ALTERNATE(log_dynamic, <a href="log_instance.h.html#30">log_source_dynamic_data</a>, \</div><div id="153" class="line none">  153                         <a href="log_core.h.html#480">LOG_INSTANCE_DYNAMIC_DATA</a>(_module_name, _inst_name))</div><div id="154" class="line none">  154 </div><div id="155" class="line none">  155 #define <a href="log_instance.h.html#155">Z_LOG_INSTANCE_REGISTER</a>(_module_name, _inst_name, _level) \</div><div id="156" class="line none">  156         <a href="log_instance.h.html#64">Z_LOG_CONST_ITEM_REGISTER</a>( \</div><div id="157" class="line none">  157                 <a href="log_instance.h.html#88">Z_LOG_INSTANCE_FULL_NAME</a>(_module_name, _inst_name), \</div><div id="158" class="line none">  158                 STRINGIFY(_module_name._inst_name), \</div><div id="159" class="line none">  159                 _level); \</div><div id="160" class="line none">  160         IF_ENABLED(CONFIG_LOG_RUNTIME_FILTERING, \</div><div id="161" class="line none">  161                    (<a href="log_instance.h.html#151">Z_LOG_RUNTIME_INSTANCE_REGISTER</a>(_module_name, _inst_name)))</div><div id="162" class="line none">  162 </div><div id="163" class="line none">  163 /**</div><div id="164" class="line none">  164  * @brief Macro for registering instance for logging with independent filtering.</div><div id="165" class="line none">  165  *</div><div id="166" class="line none">  166  * Module instance provides filtering of logs on instance level instead of</div><div id="167" class="line none">  167  * module level. Instance create using this macro can later on be used with</div><div id="168" class="line none">  168  * @ref LOG_INSTANCE_PTR_INIT or referenced by @ref LOG_INSTANCE_PTR.</div><div id="169" class="line none">  169  *</div><div id="170" class="line none">  170  * @param _module_name Module name.</div><div id="171" class="line none">  171  * @param _inst_name Instance name.</div><div id="172" class="line none">  172  * @param _level Initial static filtering.</div><div id="173" class="line none">  173  */</div><div id="174" class="line none">  174 #define <a href="log_instance.h.html#174">LOG_INSTANCE_REGISTER</a>(_module_name, _inst_name, _level) \</div><div id="175" class="line none">  175         IF_ENABLED(CONFIG_LOG, (<a href="log_instance.h.html#155">Z_LOG_INSTANCE_REGISTER</a>(_module_name, _inst_name, _level)))</div><div id="176" class="line none">  176 </div><div id="177" class="line none">  177 #ifdef __cplusplus</div><div id="178" class="line none">  178 }</div><div id="179" class="line none">  179 #endif</div><div id="180" class="line none">  180 </div><div id="181" class="line none">  181 #endif /* ZEPHYR_INCLUDE_LOGGING_LOG_INSTANCE_H_ */</div>
</div>
</body>
</html>
