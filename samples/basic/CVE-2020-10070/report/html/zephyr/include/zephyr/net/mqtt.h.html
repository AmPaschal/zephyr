
<html>
<head>
<title>zephyr/include/zephyr/net/mqtt.h</title>
<link rel="stylesheet" type="text/css" href="../../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2018 Nordic Semiconductor ASA</div><div id="3" class="line none">    3  *</div><div id="4" class="line none">    4  * SPDX-License-Identifier: Apache-2.0</div><div id="5" class="line none">    5  */</div><div id="6" class="line none">    6 </div><div id="7" class="line none">    7 /** @file mqtt.h</div><div id="8" class="line none">    8  *</div><div id="9" class="line none">    9  * @brief MQTT Client Implementation</div><div id="10" class="line none">   10  *</div><div id="11" class="line none">   11  * @note The implementation assumes TCP module is enabled.</div><div id="12" class="line none">   12  *</div><div id="13" class="line none">   13  * @note By default the implementation uses MQTT version 3.1.1.</div><div id="14" class="line none">   14  *</div><div id="15" class="line none">   15  * @defgroup mqtt_socket MQTT Client library</div><div id="16" class="line none">   16  * @since 1.14</div><div id="17" class="line none">   17  * @version 0.8.0</div><div id="18" class="line none">   18  * @ingroup networking</div><div id="19" class="line none">   19  * @{</div><div id="20" class="line none">   20  */</div><div id="21" class="line none">   21 </div><div id="22" class="line none">   22 #ifndef <a href="mqtt.h.html#23">ZEPHYR_INCLUDE_NET_MQTT_H_</a></div><div id="23" class="line none">   23 #define <a href="mqtt.h.html#23">ZEPHYR_INCLUDE_NET_MQTT_H_</a></div><div id="24" class="line none">   24 </div><div id="25" class="line none">   25 #include &lt;stddef.h&gt;</div><div id="26" class="line none">   26 </div><div id="27" class="line none">   27 #include &lt;zephyr/kernel.h&gt;</div><div id="28" class="line none">   28 #include &lt;zephyr/types.h&gt;</div><div id="29" class="line none">   29 #include &lt;zephyr/net/tls_credentials.h&gt;</div><div id="30" class="line none">   30 #include &lt;zephyr/net/net_ip.h&gt;</div><div id="31" class="line none">   31 #include &lt;zephyr/sys/<a href="mqtt.h.html#473">mutex</a>.h&gt;</div><div id="32" class="line none">   32 #include &lt;zephyr/net/<a href="mqtt.h.html#454">websocket</a>.h&gt;</div><div id="33" class="line none">   33 </div><div id="34" class="line none">   34 #ifdef __cplusplus</div><div id="35" class="line none">   35 extern "C" {</div><div id="36" class="line none">   36 #endif</div><div id="37" class="line none">   37 </div><div id="38" class="line none">   38 /**</div><div id="39" class="line none">   39  * @brief MQTT Asynchronous Events notified to the application from the module</div><div id="40" class="line none">   40  *        through the callback registered by the application.</div><div id="41" class="line none">   41  */</div><div id="42" class="line none">   42 enum <a href="mqtt.h.html#42">mqtt_evt_type</a> {</div><div id="43" class="line none">   43         /** Acknowledgment of connection request. Event result accompanying</div><div id="44" class="line none">   44          *  the event indicates whether the connection failed or succeeded.</div><div id="45" class="line none">   45          */</div><div id="46" class="line none">   46         <a href="mqtt.h.html#46">MQTT_EVT_CONNACK</a>,</div><div id="47" class="line none">   47 </div><div id="48" class="line none">   48         /** Disconnection Event. MQTT Client Reference is no longer valid once</div><div id="49" class="line none">   49          *  this event is received for the client.</div><div id="50" class="line none">   50          */</div><div id="51" class="line none">   51         <a href="mqtt.h.html#51">MQTT_EVT_DISCONNECT</a>,</div><div id="52" class="line none">   52 </div><div id="53" class="line none">   53         /** Publish event received when message is published on a topic client</div><div id="54" class="line none">   54          *  is subscribed to.</div><div id="55" class="line none">   55          *</div><div id="56" class="line none">   56          * @note PUBLISH event structure only contains payload size, the payload</div><div id="57" class="line none">   57          *       data parameter should be ignored. Payload content has to be</div><div id="58" class="line none">   58          *       read manually with @ref mqtt_read_publish_payload function.</div><div id="59" class="line none">   59          */</div><div id="60" class="line none">   60         <a href="mqtt.h.html#60">MQTT_EVT_PUBLISH</a>,</div><div id="61" class="line none">   61 </div><div id="62" class="line none">   62         /** Acknowledgment for published message with QoS 1. */</div><div id="63" class="line none">   63         <a href="mqtt.h.html#63">MQTT_EVT_PUBACK</a>,</div><div id="64" class="line none">   64 </div><div id="65" class="line none">   65         /** Reception confirmation for published message with QoS 2. */</div><div id="66" class="line none">   66         <a href="mqtt.h.html#66">MQTT_EVT_PUBREC</a>,</div><div id="67" class="line none">   67 </div><div id="68" class="line none">   68         /** Release of published message with QoS 2. */</div><div id="69" class="line none">   69         <a href="mqtt.h.html#69">MQTT_EVT_PUBREL</a>,</div><div id="70" class="line none">   70 </div><div id="71" class="line none">   71         /** Confirmation to a publish release message with QoS 2. */</div><div id="72" class="line none">   72         <a href="mqtt.h.html#72">MQTT_EVT_PUBCOMP</a>,</div><div id="73" class="line none">   73 </div><div id="74" class="line none">   74         /** Acknowledgment to a subscribe request. */</div><div id="75" class="line none">   75         <a href="mqtt.h.html#75">MQTT_EVT_SUBACK</a>,</div><div id="76" class="line none">   76 </div><div id="77" class="line none">   77         /** Acknowledgment to a unsubscribe request. */</div><div id="78" class="line none">   78         <a href="mqtt.h.html#78">MQTT_EVT_UNSUBACK</a>,</div><div id="79" class="line none">   79 </div><div id="80" class="line none">   80         /** Ping Response from server. */</div><div id="81" class="line none">   81         <a href="mqtt.h.html#81">MQTT_EVT_PINGRESP</a>,</div><div id="82" class="line none">   82 };</div><div id="83" class="line none">   83 </div><div id="84" class="line none">   84 /** @brief MQTT version protocol level. */</div><div id="85" class="line none">   85 enum <a href="mqtt.h.html#85">mqtt_version</a> {</div><div id="86" class="line none">   86         <a href="mqtt.h.html#86">MQTT_VERSION_3_1_0</a> = 3, /**&lt; Protocol level for 3.1.0. */</div><div id="87" class="line none">   87         <a href="mqtt.h.html#87">MQTT_VERSION_3_1_1</a> = 4  /**&lt; Protocol level for 3.1.1. */</div><div id="88" class="line none">   88 };</div><div id="89" class="line none">   89 </div><div id="90" class="line none">   90 /** @brief MQTT Quality of Service types. */</div><div id="91" class="line none">   91 enum <a href="mqtt.h.html#91">mqtt_qos</a> {</div><div id="92" class="line none">   92         /** Lowest Quality of Service, no acknowledgment needed for published</div><div id="93" class="line none">   93          *  message.</div><div id="94" class="line none">   94          */</div><div id="95" class="line none">   95         <a href="mqtt.h.html#95">MQTT_QOS_0_AT_MOST_ONCE</a> = 0x00,</div><div id="96" class="line none">   96 </div><div id="97" class="line none">   97         /** Medium Quality of Service, if acknowledgment expected for published</div><div id="98" class="line none">   98          *  message, duplicate messages permitted.</div><div id="99" class="line none">   99          */</div><div id="100" class="line none">  100         <a href="mqtt.h.html#100">MQTT_QOS_1_AT_LEAST_ONCE</a> = 0x01,</div><div id="101" class="line none">  101 </div><div id="102" class="line none">  102         /** Highest Quality of Service, acknowledgment expected and message</div><div id="103" class="line none">  103          *  shall be published only once. Message not published to interested</div><div id="104" class="line none">  104          *  parties unless client issues a PUBREL.</div><div id="105" class="line none">  105          */</div><div id="106" class="line none">  106         <a href="mqtt.h.html#106">MQTT_QOS_2_EXACTLY_ONCE</a>  = 0x02</div><div id="107" class="line none">  107 };</div><div id="108" class="line none">  108 </div><div id="109" class="line none">  109 /** @brief MQTT CONNACK return codes. */</div><div id="110" class="line none">  110 enum <a href="mqtt.h.html#110">mqtt_conn_return_code</a> {</div><div id="111" class="line none">  111         /** Connection accepted. */</div><div id="112" class="line none">  112         <a href="mqtt.h.html#112">MQTT_CONNECTION_ACCEPTED</a>                = 0x00,</div><div id="113" class="line none">  113 </div><div id="114" class="line none">  114         /** The Server does not support the level of the MQTT protocol</div><div id="115" class="line none">  115          * requested by the Client.</div><div id="116" class="line none">  116          */</div><div id="117" class="line none">  117         <a href="mqtt.h.html#117">MQTT_UNACCEPTABLE_PROTOCOL_VERSION</a>      = 0x01,</div><div id="118" class="line none">  118 </div><div id="119" class="line none">  119         /** The Client identifier is correct UTF-8 but not allowed by the</div><div id="120" class="line none">  120          *  Server.</div><div id="121" class="line none">  121          */</div><div id="122" class="line none">  122         <a href="mqtt.h.html#122">MQTT_IDENTIFIER_REJECTED</a>                = 0x02,</div><div id="123" class="line none">  123 </div><div id="124" class="line none">  124         /** The Network Connection has been made but the MQTT service is</div><div id="125" class="line none">  125          *  unavailable.</div><div id="126" class="line none">  126          */</div><div id="127" class="line none">  127         <a href="mqtt.h.html#127">MQTT_SERVER_UNAVAILABLE</a>                 = 0x03,</div><div id="128" class="line none">  128 </div><div id="129" class="line none">  129         /** The data in the user name or password is malformed. */</div><div id="130" class="line none">  130         <a href="mqtt.h.html#130">MQTT_BAD_USER_NAME_OR_PASSWORD</a>          = 0x04,</div><div id="131" class="line none">  131 </div><div id="132" class="line none">  132         /** The Client is not authorized to connect. */</div><div id="133" class="line none">  133         <a href="mqtt.h.html#133">MQTT_NOT_AUTHORIZED</a>                     = 0x05</div><div id="134" class="line none">  134 };</div><div id="135" class="line none">  135 </div><div id="136" class="line none">  136 /** @brief MQTT SUBACK return codes. */</div><div id="137" class="line none">  137 enum <a href="mqtt.h.html#137">mqtt_suback_return_code</a> {</div><div id="138" class="line none">  138         /** Subscription with QoS 0 succeeded. */</div><div id="139" class="line none">  139         <a href="mqtt.h.html#139">MQTT_SUBACK_SUCCESS_QoS_0</a> = 0x00,</div><div id="140" class="line none">  140 </div><div id="141" class="line none">  141         /** Subscription with QoS 1 succeeded. */</div><div id="142" class="line none">  142         <a href="mqtt.h.html#142">MQTT_SUBACK_SUCCESS_QoS_1</a> = 0x01,</div><div id="143" class="line none">  143 </div><div id="144" class="line none">  144         /** Subscription with QoS 2 succeeded. */</div><div id="145" class="line none">  145         <a href="mqtt.h.html#145">MQTT_SUBACK_SUCCESS_QoS_2</a> = 0x02,</div><div id="146" class="line none">  146 </div><div id="147" class="line none">  147         /** Subscription for a topic failed. */</div><div id="148" class="line none">  148         <a href="mqtt.h.html#148">MQTT_SUBACK_FAILURE</a> = 0x80</div><div id="149" class="line none">  149 };</div><div id="150" class="line none">  150 </div><div id="151" class="line none">  151 /** @brief Abstracts UTF-8 encoded strings. */</div><div id="152" class="line none">  152 struct <a href="mqtt.h.html#152">mqtt_utf8</a> {</div><div id="153" class="line none">  153         const uint8_t *<a href="mqtt.h.html#153">utf8</a>;       /**&lt; Pointer to UTF-8 string. */</div><div id="154" class="line none">  154         uint32_t <a href="../kernel.h.html#4716">size</a>;             /**&lt; Size of UTF string, in bytes. */</div><div id="155" class="line none">  155 };</div><div id="156" class="line none">  156 </div><div id="157" class="line none">  157 /**</div><div id="158" class="line none">  158  * @brief Initialize UTF-8 encoded string from C literal string.</div><div id="159" class="line none">  159  *</div><div id="160" class="line none">  160  * Use it as follows:</div><div id="161" class="line none">  161  *</div><div id="162" class="line none">  162  * struct mqtt_utf8 password = MQTT_UTF8_LITERAL("my_pass");</div><div id="163" class="line none">  163  *</div><div id="164" class="line none">  164  * @param[in] literal Literal string from which to generate mqtt_utf8 object.</div><div id="165" class="line none">  165  */</div><div id="166" class="line none">  166 #define <a href="mqtt.h.html#166">MQTT_UTF8_LITERAL</a>(literal)                              \</div><div id="167" class="line none">  167         ((struct <a href="mqtt.h.html#152">mqtt_utf8</a>) {literal, sizeof(literal) - 1})</div><div id="168" class="line none">  168 </div><div id="169" class="line none">  169 /** @brief Abstracts binary strings. */</div><div id="170" class="line none">  170 struct <a href="mqtt.h.html#170">mqtt_binstr</a> {</div><div id="171" class="line none">  171         uint8_t *<a href="../logging/log_msg.h.html#100">data</a>;             /**&lt; Pointer to binary stream. */</div><div id="172" class="line none">  172         uint32_t <a href="mqtt.h.html#172">len</a>;              /**&lt; Length of binary stream. */</div><div id="173" class="line none">  173 };</div><div id="174" class="line none">  174 </div><div id="175" class="line none">  175 /** @brief Abstracts MQTT UTF-8 encoded topic that can be subscribed</div><div id="176" class="line none">  176  *         to or published.</div><div id="177" class="line none">  177  */</div><div id="178" class="line none">  178 struct <a href="mqtt.h.html#178">mqtt_topic</a> {</div><div id="179" class="line none">  179         /** Topic on to be published or subscribed to. */</div><div id="180" class="line none">  180         struct <a href="mqtt.h.html#152">mqtt_utf8</a> <a href="mqtt.h.html#180">topic</a>;</div><div id="181" class="line none">  181 </div><div id="182" class="line none">  182         /** Quality of service requested for the subscription.</div><div id="183" class="line none">  183          *  @ref mqtt_qos for details.</div><div id="184" class="line none">  184          */</div><div id="185" class="line none">  185         uint8_t <a href="mqtt.h.html#185">qos</a>;</div><div id="186" class="line none">  186 };</div><div id="187" class="line none">  187 </div><div id="188" class="line none">  188 /** @brief Parameters for a publish message. */</div><div id="189" class="line none">  189 struct <a href="mqtt.h.html#189">mqtt_publish_message</a> {</div><div id="190" class="line none">  190         struct <a href="mqtt.h.html#178">mqtt_topic</a> <a href="mqtt.h.html#180">topic</a>;     /**&lt; Topic on which data was published. */</div><div id="191" class="line none">  191         struct <a href="mqtt.h.html#170">mqtt_binstr</a> <a href="mqtt.h.html#191">payload</a>; /**&lt; Payload on the topic published. */</div><div id="192" class="line none">  192 };</div><div id="193" class="line none">  193 </div><div id="194" class="line none">  194 /** @brief Parameters for a connection acknowledgment (CONNACK). */</div><div id="195" class="line none">  195 struct <a href="mqtt.h.html#195">mqtt_connack_param</a> {</div><div id="196" class="line none">  196         /** The Session Present flag enables a Client to establish whether</div><div id="197" class="line none">  197          *  the Client and Server have a consistent view about whether there</div><div id="198" class="line none">  198          *  is already stored Session state.</div><div id="199" class="line none">  199          */</div><div id="200" class="line none">  200         uint8_t <a href="mqtt.h.html#200">session_present_flag</a>;</div><div id="201" class="line none">  201 </div><div id="202" class="line none">  202         /** The appropriate non-zero Connect return code indicates if the Server</div><div id="203" class="line none">  203          *  is unable to process a connection request for some reason.</div><div id="204" class="line none">  204          */</div><div id="205" class="line none">  205         enum <a href="mqtt.h.html#110">mqtt_conn_return_code</a> <a href="mqtt.h.html#205">return_code</a>;</div><div id="206" class="line none">  206 };</div><div id="207" class="line none">  207 </div><div id="208" class="line none">  208 /** @brief Parameters for MQTT publish acknowledgment (PUBACK). */</div><div id="209" class="line none">  209 struct <a href="mqtt.h.html#209">mqtt_puback_param</a> {</div><div id="210" class="line none">  210         /** Message id of the PUBLISH message being acknowledged */</div><div id="211" class="line none">  211         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="212" class="line none">  212 };</div><div id="213" class="line none">  213 </div><div id="214" class="line none">  214 /** @brief Parameters for MQTT publish receive (PUBREC). */</div><div id="215" class="line none">  215 struct <a href="mqtt.h.html#215">mqtt_pubrec_param</a> {</div><div id="216" class="line none">  216         /** Message id of the PUBLISH message being acknowledged */</div><div id="217" class="line none">  217         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="218" class="line none">  218 };</div><div id="219" class="line none">  219 </div><div id="220" class="line none">  220 /** @brief Parameters for MQTT publish release (PUBREL). */</div><div id="221" class="line none">  221 struct <a href="mqtt.h.html#221">mqtt_pubrel_param</a> {</div><div id="222" class="line none">  222         /** Message id of the PUBREC message being acknowledged */</div><div id="223" class="line none">  223         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="224" class="line none">  224 };</div><div id="225" class="line none">  225 </div><div id="226" class="line none">  226 /** @brief Parameters for MQTT publish complete (PUBCOMP). */</div><div id="227" class="line none">  227 struct <a href="mqtt.h.html#227">mqtt_pubcomp_param</a> {</div><div id="228" class="line none">  228         /** Message id of the PUBREL message being acknowledged */</div><div id="229" class="line none">  229         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="230" class="line none">  230 };</div><div id="231" class="line none">  231 </div><div id="232" class="line none">  232 /** @brief Parameters for MQTT subscription acknowledgment (SUBACK). */</div><div id="233" class="line none">  233 struct <a href="mqtt.h.html#233">mqtt_suback_param</a> {</div><div id="234" class="line none">  234         /** Message id of the SUBSCRIBE message being acknowledged */</div><div id="235" class="line none">  235         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="236" class="line none">  236         /** Return codes indicating maximum QoS level granted for each topic</div><div id="237" class="line none">  237          *  in the subscription list.</div><div id="238" class="line none">  238          */</div><div id="239" class="line none">  239         struct <a href="mqtt.h.html#170">mqtt_binstr</a> <a href="mqtt.h.html#239">return_codes</a>;</div><div id="240" class="line none">  240 };</div><div id="241" class="line none">  241 </div><div id="242" class="line none">  242 /** @brief Parameters for MQTT unsubscribe acknowledgment (UNSUBACK). */</div><div id="243" class="line none">  243 struct <a href="mqtt.h.html#243">mqtt_unsuback_param</a> {</div><div id="244" class="line none">  244         /** Message id of the UNSUBSCRIBE message being acknowledged */</div><div id="245" class="line none">  245         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="246" class="line none">  246 };</div><div id="247" class="line none">  247 </div><div id="248" class="line none">  248 /** @brief Parameters for a publish message (PUBLISH). */</div><div id="249" class="line none">  249 struct <a href="mqtt.h.html#249">mqtt_publish_param</a> {</div><div id="250" class="line none">  250         /** Messages including topic, QoS and its payload (if any)</div><div id="251" class="line none">  251          *  to be published.</div><div id="252" class="line none">  252          */</div><div id="253" class="line none">  253         struct <a href="mqtt.h.html#189">mqtt_publish_message</a> <a href="mqtt.h.html#253">message</a>;</div><div id="254" class="line none">  254 </div><div id="255" class="line none">  255         /** Message id used for the publish message. Redundant for QoS 0. */</div><div id="256" class="line none">  256         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="257" class="line none">  257 </div><div id="258" class="line none">  258         /** Duplicate flag. If 1, it indicates the message is being</div><div id="259" class="line none">  259          *  retransmitted. Has no meaning with QoS 0.</div><div id="260" class="line none">  260          */</div><div id="261" class="line none">  261         uint8_t <a href="mqtt.h.html#261">dup_flag</a> : 1;</div><div id="262" class="line none">  262 </div><div id="263" class="line none">  263         /** Retain flag. If 1, the message shall be stored persistently</div><div id="264" class="line none">  264          *  by the broker.</div><div id="265" class="line none">  265          */</div><div id="266" class="line none">  266         uint8_t <a href="mqtt.h.html#266">retain_flag</a> : 1;</div><div id="267" class="line none">  267 };</div><div id="268" class="line none">  268 </div><div id="269" class="line none">  269 /** @brief List of topics in a subscription request. */</div><div id="270" class="line none">  270 struct <a href="mqtt.h.html#270">mqtt_subscription_list</a> {</div><div id="271" class="line none">  271         /** Array containing topics along with QoS for each. */</div><div id="272" class="line none">  272         struct <a href="mqtt.h.html#178">mqtt_topic</a> *<a href="mqtt.h.html#272">list</a>;</div><div id="273" class="line none">  273 </div><div id="274" class="line none">  274         /** Number of topics in the subscription list */</div><div id="275" class="line none">  275         uint16_t <a href="mqtt.h.html#275">list_count</a>;</div><div id="276" class="line none">  276 </div><div id="277" class="line none">  277         /** Message id used to identify subscription request. */</div><div id="278" class="line none">  278         uint16_t <a href="mqtt.h.html#211">message_id</a>;</div><div id="279" class="line none">  279 };</div><div id="280" class="line none">  280 </div><div id="281" class="line none">  281 /**</div><div id="282" class="line none">  282  * @brief Defines event parameters notified along with asynchronous events</div><div id="283" class="line none">  283  *        to the application.</div><div id="284" class="line none">  284  */</div><div id="285" class="line none">  285 union <a href="mqtt.h.html#285">mqtt_evt_param</a> {</div><div id="286" class="line none">  286         /** Parameters accompanying MQTT_EVT_CONNACK event. */</div><div id="287" class="line none">  287         struct <a href="mqtt.h.html#195">mqtt_connack_param</a> <a href="mqtt.h.html#287">connack</a>;</div><div id="288" class="line none">  288 </div><div id="289" class="line none">  289         /** Parameters accompanying MQTT_EVT_PUBLISH event.</div><div id="290" class="line none">  290          *</div><div id="291" class="line none">  291          * @note PUBLISH event structure only contains payload size, the payload</div><div id="292" class="line none">  292          *       data parameter should be ignored. Payload content has to be</div><div id="293" class="line none">  293          *       read manually with @ref mqtt_read_publish_payload function.</div><div id="294" class="line none">  294          */</div><div id="295" class="line none">  295         struct <a href="mqtt.h.html#249">mqtt_publish_param</a> <a href="mqtt.h.html#295">publish</a>;</div><div id="296" class="line none">  296 </div><div id="297" class="line none">  297         /** Parameters accompanying MQTT_EVT_PUBACK event. */</div><div id="298" class="line none">  298         struct <a href="mqtt.h.html#209">mqtt_puback_param</a> <a href="mqtt.h.html#298">puback</a>;</div><div id="299" class="line none">  299 </div><div id="300" class="line none">  300         /** Parameters accompanying MQTT_EVT_PUBREC event. */</div><div id="301" class="line none">  301         struct <a href="mqtt.h.html#215">mqtt_pubrec_param</a> <a href="mqtt.h.html#301">pubrec</a>;</div><div id="302" class="line none">  302 </div><div id="303" class="line none">  303         /** Parameters accompanying MQTT_EVT_PUBREL event. */</div><div id="304" class="line none">  304         struct <a href="mqtt.h.html#221">mqtt_pubrel_param</a> <a href="mqtt.h.html#304">pubrel</a>;</div><div id="305" class="line none">  305 </div><div id="306" class="line none">  306         /** Parameters accompanying MQTT_EVT_PUBCOMP event. */</div><div id="307" class="line none">  307         struct <a href="mqtt.h.html#227">mqtt_pubcomp_param</a> <a href="mqtt.h.html#307">pubcomp</a>;</div><div id="308" class="line none">  308 </div><div id="309" class="line none">  309         /** Parameters accompanying MQTT_EVT_SUBACK event. */</div><div id="310" class="line none">  310         struct <a href="mqtt.h.html#233">mqtt_suback_param</a> <a href="mqtt.h.html#310">suback</a>;</div><div id="311" class="line none">  311 </div><div id="312" class="line none">  312         /** Parameters accompanying MQTT_EVT_UNSUBACK event. */</div><div id="313" class="line none">  313         struct <a href="mqtt.h.html#243">mqtt_unsuback_param</a> <a href="mqtt.h.html#313">unsuback</a>;</div><div id="314" class="line none">  314 };</div><div id="315" class="line none">  315 </div><div id="316" class="line none">  316 /** @brief Defines MQTT asynchronous event notified to the application. */</div><div id="317" class="line none">  317 struct <a href="mqtt.h.html#317">mqtt_evt</a> {</div><div id="318" class="line none">  318         /** Identifies the event. */</div><div id="319" class="line none">  319         enum <a href="mqtt.h.html#42">mqtt_evt_type</a> <a href="../kernel.h.html#5723">type</a>;</div><div id="320" class="line none">  320 </div><div id="321" class="line none">  321         /** Contains parameters (if any) accompanying the event. */</div><div id="322" class="line none">  322         union <a href="mqtt.h.html#285">mqtt_evt_param</a> <a href="mqtt.h.html#322">param</a>;</div><div id="323" class="line none">  323 </div><div id="324" class="line none">  324         /** Event result. 0 or a negative error code (errno.h) indicating</div><div id="325" class="line none">  325          *  reason of failure.</div><div id="326" class="line none">  326          */</div><div id="327" class="line none">  327         int <a href="../kernel.h.html#5699">result</a>;</div><div id="328" class="line none">  328 };</div><div id="329" class="line none">  329 </div><div id="330" class="line none">  330 struct <a href="mqtt.h.html#330">mqtt_client</a>;</div><div id="331" class="line none">  331 </div><div id="332" class="line none">  332 /**</div><div id="333" class="line none">  333  * @brief Asynchronous event notification callback registered by the</div><div id="334" class="line none">  334  *        application.</div><div id="335" class="line none">  335  *</div><div id="336" class="line none">  336  * @param[in] client Identifies the client for which the event is notified.</div><div id="337" class="line none">  337  * @param[in] evt Event description along with result and associated</div><div id="338" class="line none">  338  *                parameters (if any).</div><div id="339" class="line none">  339  */</div><div id="340" class="line none">  340 typedef void (*<a href="mqtt.h.html#340">mqtt_evt_cb_t</a>)(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="341" class="line none">  341                               const struct <a href="mqtt.h.html#317">mqtt_evt</a> *evt);</div><div id="342" class="line none">  342 </div><div id="343" class="line none">  343 /** @brief TLS configuration for secure MQTT transports. */</div><div id="344" class="line none">  344 struct <a href="mqtt.h.html#344">mqtt_sec_config</a> {</div><div id="345" class="line none">  345         /** Indicates the preference for peer verification. */</div><div id="346" class="line none">  346         int <a href="mqtt.h.html#346">peer_verify</a>;</div><div id="347" class="line none">  347 </div><div id="348" class="line none">  348         /** Indicates the number of entries in the cipher list. */</div><div id="349" class="line none">  349         uint32_t <a href="mqtt.h.html#349">cipher_count</a>;</div><div id="350" class="line none">  350 </div><div id="351" class="line none">  351         /** Indicates the list of ciphers to be used for the session.</div><div id="352" class="line none">  352          *  May be NULL to use the default ciphers.</div><div id="353" class="line none">  353          */</div><div id="354" class="line none">  354         const int *<a href="mqtt.h.html#354">cipher_list</a>;</div><div id="355" class="line none">  355 </div><div id="356" class="line none">  356         /** Indicates the number of entries in the sec tag list. */</div><div id="357" class="line none">  357         uint32_t <a href="mqtt.h.html#357">sec_tag_count</a>;</div><div id="358" class="line none">  358 </div><div id="359" class="line none">  359         /** Indicates the list of security tags to be used for the session. */</div><div id="360" class="line none">  360         const sec_tag_t *<a href="mqtt.h.html#360">sec_tag_list</a>;</div><div id="361" class="line none">  361 </div><div id="362" class="line none">  362 #if defined(CONFIG_MQTT_LIB_TLS_USE_ALPN)</div><div id="363" class="line none">  363         /**</div><div id="364" class="line none">  364          * Pointer to array of string indicating the ALPN protocol name.</div><div id="365" class="line none">  365          * May be NULL to skip ALPN protocol negotiation.</div><div id="366" class="line none">  366          */</div><div id="367" class="line none">  367         const char **<a href="mqtt.h.html#367">alpn_protocol_name_list</a>;</div><div id="368" class="line none">  368 </div><div id="369" class="line none">  369         /**</div><div id="370" class="line none">  370          * Indicate number of ALPN protocol name in alpn protocol name list.</div><div id="371" class="line none">  371          */</div><div id="372" class="line none">  372         uint32_t <a href="mqtt.h.html#372">alpn_protocol_name_count</a>;</div><div id="373" class="line none">  373 #endif</div><div id="374" class="line none">  374 </div><div id="375" class="line none">  375         /** Peer hostname for ceritificate verification.</div><div id="376" class="line none">  376          *  May be NULL to skip hostname verification.</div><div id="377" class="line none">  377          */</div><div id="378" class="line none">  378         const char *<a href="mqtt.h.html#378">hostname</a>;</div><div id="379" class="line none">  379 </div><div id="380" class="line none">  380         /** Indicates the preference for copying certificates to the heap. */</div><div id="381" class="line none">  381         int <a href="mqtt.h.html#381">cert_nocopy</a>;</div><div id="382" class="line none">  382 };</div><div id="383" class="line none">  383 </div><div id="384" class="line none">  384 /** @brief MQTT transport type. */</div><div id="385" class="line none">  385 enum <a href="mqtt.h.html#385">mqtt_transport_type</a> {</div><div id="386" class="line none">  386         /** Use non secure TCP transport for MQTT connection. */</div><div id="387" class="line none">  387         <a href="mqtt.h.html#387">MQTT_TRANSPORT_NON_SECURE</a>,</div><div id="388" class="line none">  388 </div><div id="389" class="line none">  389 #if defined(CONFIG_MQTT_LIB_TLS)</div><div id="390" class="line none">  390         /** Use secure TCP transport (TLS) for MQTT connection. */</div><div id="391" class="line none">  391         <a href="mqtt.h.html#391">MQTT_TRANSPORT_SECURE</a>,</div><div id="392" class="line none">  392 #endif /* CONFIG_MQTT_LIB_TLS */</div><div id="393" class="line none">  393 </div><div id="394" class="line none">  394 #if defined(CONFIG_MQTT_LIB_WEBSOCKET)</div><div id="395" class="line none">  395         /** Use non secure Websocket transport for MQTT connection. */</div><div id="396" class="line none">  396         <a href="mqtt.h.html#396">MQTT_TRANSPORT_NON_SECURE_WEBSOCKET</a>,</div><div id="397" class="line none">  397 #if defined(CONFIG_MQTT_LIB_TLS)</div><div id="398" class="line none">  398         /** Use secure Websocket transport (TLS) for MQTT connection. */</div><div id="399" class="line none">  399         <a href="mqtt.h.html#399">MQTT_TRANSPORT_SECURE_WEBSOCKET</a>,</div><div id="400" class="line none">  400 #endif</div><div id="401" class="line none">  401 #endif /* CONFIG_MQTT_LIB_WEBSOCKET */</div><div id="402" class="line none">  402 #if defined(CONFIG_MQTT_LIB_CUSTOM_TRANSPORT)</div><div id="403" class="line none">  403         /** Use custom transport for MQTT connection. */</div><div id="404" class="line none">  404         <a href="mqtt.h.html#404">MQTT_TRANSPORT_CUSTOM</a>,</div><div id="405" class="line none">  405 #endif /* CONFIG_MQTT_LIB_CUSTOM_TRANSPORT */</div><div id="406" class="line none">  406 </div><div id="407" class="line none">  407         /** Shall not be used as a transport type.</div><div id="408" class="line none">  408          *  Indicator of maximum transport types possible.</div><div id="409" class="line none">  409          */</div><div id="410" class="line none">  410         <a href="mqtt.h.html#410">MQTT_TRANSPORT_NUM</a></div><div id="411" class="line none">  411 };</div><div id="412" class="line none">  412 </div><div id="413" class="line none">  413 /** @brief MQTT transport specific data. */</div><div id="414" class="line none">  414 struct <a href="mqtt.h.html#414">mqtt_transport</a> {</div><div id="415" class="line none">  415         /** Transport type selection for client instance.</div><div id="416" class="line none">  416          *  @ref mqtt_transport_type for possible values. MQTT_TRANSPORT_MAX</div><div id="417" class="line none">  417          *  is not a valid type.</div><div id="418" class="line none">  418          */</div><div id="419" class="line none">  419         enum <a href="mqtt.h.html#385">mqtt_transport_type</a> <a href="../kernel.h.html#5723">type</a>;</div><div id="420" class="line none">  420 </div><div id="421" class="line none">  421         /** Use either unsecured TCP or secured TLS transport */</div><div id="422" class="line none">  422         union {</div><div id="423" class="line none">  423                 /** TCP socket transport for MQTT */</div><div id="424" class="line none">  424                 struct {</div><div id="425" class="line none">  425                         /** Socket descriptor. */</div><div id="426" class="line none">  426                         int <a href="mqtt.h.html#426">sock</a>;</div><div id="427" class="line none">  427                 } <a href="mqtt.h.html#427">tcp</a>;</div><div id="428" class="line none">  428 </div><div id="429" class="line none">  429 #if defined(CONFIG_MQTT_LIB_TLS)</div><div id="430" class="line none">  430                 /** TLS socket transport for MQTT */</div><div id="431" class="line none">  431                 struct {</div><div id="432" class="line none">  432                         /** Socket descriptor. */</div><div id="433" class="line none">  433                         int <a href="mqtt.h.html#426">sock</a>;</div><div id="434" class="line none">  434 </div><div id="435" class="line none">  435                         /** TLS configuration. See @ref mqtt_sec_config for</div><div id="436" class="line none">  436                          *  details.</div><div id="437" class="line none">  437                          */</div><div id="438" class="line none">  438                         struct <a href="mqtt.h.html#344">mqtt_sec_config</a> <a href="mqtt.h.html#438">config</a>;</div><div id="439" class="line none">  439                 } <a href="../kernel/thread.h.html#353">tls</a>;</div><div id="440" class="line none">  440 #endif /* CONFIG_MQTT_LIB_TLS */</div><div id="441" class="line none">  441         };</div><div id="442" class="line none">  442 </div><div id="443" class="line none">  443 #if defined(CONFIG_MQTT_LIB_WEBSOCKET)</div><div id="444" class="line none">  444         /** Websocket transport for MQTT */</div><div id="445" class="line none">  445         struct {</div><div id="446" class="line none">  446                 /** Websocket configuration. */</div><div id="447" class="line none">  447                 struct websocket_request <a href="mqtt.h.html#438">config</a>;</div><div id="448" class="line none">  448 </div><div id="449" class="line none">  449                 /** Socket descriptor */</div><div id="450" class="line none">  450                 int <a href="mqtt.h.html#426">sock</a>;</div><div id="451" class="line none">  451 </div><div id="452" class="line none">  452                 /** Websocket timeout, in milliseconds. */</div><div id="453" class="line none">  453                 int32_t <a href="../kernel.h.html#1452">timeout</a>;</div><div id="454" class="line none">  454         } <a href="mqtt.h.html#454">websocket</a>;</div><div id="455" class="line none">  455 #endif</div><div id="456" class="line none">  456 </div><div id="457" class="line none">  457 #if defined(CONFIG_MQTT_LIB_CUSTOM_TRANSPORT)</div><div id="458" class="line none">  458         /** User defined data for custom transport for MQTT. */</div><div id="459" class="line none">  459         void *<a href="mqtt.h.html#459">custom_transport_data</a>;</div><div id="460" class="line none">  460 #endif /* CONFIG_MQTT_LIB_CUSTOM_TRANSPORT */</div><div id="461" class="line none">  461 </div><div id="462" class="line none">  462 #if defined(CONFIG_SOCKS)</div><div id="463" class="line none">  463         struct {</div><div id="464" class="line none">  464                 struct sockaddr <a href="../kernel/thread.h.html#178">addr</a>;</div><div id="465" class="line none">  465                 socklen_t <a href="mqtt.h.html#465">addrlen</a>;</div><div id="466" class="line none">  466         } <a href="mqtt.h.html#466">proxy</a>;</div><div id="467" class="line none">  467 #endif</div><div id="468" class="line none">  468 };</div><div id="469" class="line none">  469 </div><div id="470" class="line none">  470 /** @brief MQTT internal state. */</div><div id="471" class="line none">  471 struct <a href="mqtt.h.html#471">mqtt_internal</a> {</div><div id="472" class="line none">  472         /** Internal. Mutex to protect access to the client instance. */</div><div id="473" class="line none">  473         struct <a href="../sys/mutex.h.html#137">sys_mutex</a> <a href="mqtt.h.html#473">mutex</a>;</div><div id="474" class="line none">  474 </div><div id="475" class="line none">  475         /** Internal. Wall clock value (in milliseconds) of the last activity</div><div id="476" class="line none">  476          *  that occurred. Needed for periodic PING.</div><div id="477" class="line none">  477          */</div><div id="478" class="line none">  478         uint32_t <a href="mqtt.h.html#478">last_activity</a>;</div><div id="479" class="line none">  479 </div><div id="480" class="line none">  480         /** Internal. Client's state in the connection. */</div><div id="481" class="line none">  481         uint32_t <a href="../kernel.h.html#5726">state</a>;</div><div id="482" class="line none">  482 </div><div id="483" class="line none">  483         /** Internal.  Packet length read so far. */</div><div id="484" class="line none">  484         uint32_t <a href="mqtt.h.html#484">rx_buf_datalen</a>;</div><div id="485" class="line none">  485 </div><div id="486" class="line none">  486         /** Internal. Remaining payload length to read. */</div><div id="487" class="line none">  487         uint32_t <a href="mqtt.h.html#487">remaining_payload</a>;</div><div id="488" class="line none">  488 };</div><div id="489" class="line none">  489 </div><div id="490" class="line none">  490 /**</div><div id="491" class="line none">  491  * @brief MQTT Client definition to maintain information relevant to the</div><div id="492" class="line none">  492  *        client.</div><div id="493" class="line none">  493  */</div><div id="494" class="line none">  494 struct <a href="mqtt.h.html#330">mqtt_client</a> {</div><div id="495" class="line none">  495         /** MQTT client internal state. */</div><div id="496" class="line none">  496         struct <a href="mqtt.h.html#471">mqtt_internal</a> <a href="mqtt.h.html#496">internal</a>;</div><div id="497" class="line none">  497 </div><div id="498" class="line none">  498         /** MQTT transport configuration and data. */</div><div id="499" class="line none">  499         struct <a href="mqtt.h.html#414">mqtt_transport</a> <a href="mqtt.h.html#499">transport</a>;</div><div id="500" class="line none">  500 </div><div id="501" class="line none">  501         /** Unique client identification to be used for the connection. */</div><div id="502" class="line none">  502         struct <a href="mqtt.h.html#152">mqtt_utf8</a> <a href="mqtt.h.html#502">client_id</a>;</div><div id="503" class="line none">  503 </div><div id="504" class="line none">  504         /** Broker details, for example, address, port. Address type should</div><div id="505" class="line none">  505          *  be compatible with transport used.</div><div id="506" class="line none">  506          */</div><div id="507" class="line none">  507         const void *<a href="mqtt.h.html#507">broker</a>;</div><div id="508" class="line none">  508 </div><div id="509" class="line none">  509         /** User name (if any) to be used for the connection. NULL indicates</div><div id="510" class="line none">  510          *  no user name.</div><div id="511" class="line none">  511          */</div><div id="512" class="line none">  512         struct <a href="mqtt.h.html#152">mqtt_utf8</a> *<a href="mqtt.h.html#512">user_name</a>;</div><div id="513" class="line none">  513 </div><div id="514" class="line none">  514         /** Password (if any) to be used for the connection. Note that if</div><div id="515" class="line none">  515          *  password is provided, user name shall also be provided. NULL</div><div id="516" class="line none">  516          *  indicates no password.</div><div id="517" class="line none">  517          */</div><div id="518" class="line none">  518         struct <a href="mqtt.h.html#152">mqtt_utf8</a> *<a href="mqtt.h.html#518">password</a>;</div><div id="519" class="line none">  519 </div><div id="520" class="line none">  520         /** Will topic and QoS. Can be NULL. */</div><div id="521" class="line none">  521         struct <a href="mqtt.h.html#178">mqtt_topic</a> *<a href="mqtt.h.html#521">will_topic</a>;</div><div id="522" class="line none">  522 </div><div id="523" class="line none">  523         /** Will message. Can be NULL. Non NULL value valid only if will topic</div><div id="524" class="line none">  524          *  is not NULL.</div><div id="525" class="line none">  525          */</div><div id="526" class="line none">  526         struct <a href="mqtt.h.html#152">mqtt_utf8</a> *<a href="mqtt.h.html#526">will_message</a>;</div><div id="527" class="line none">  527 </div><div id="528" class="line none">  528         /** Application callback registered with the module to get MQTT events.</div><div id="529" class="line none">  529          */</div><div id="530" class="line none">  530         <a href="mqtt.h.html#340">mqtt_evt_cb_t</a> <a href="mqtt.h.html#530">evt_cb</a>;</div><div id="531" class="line none">  531 </div><div id="532" class="line none">  532         /** Receive buffer used for MQTT packet reception in RX path. */</div><div id="533" class="line none">  533         uint8_t *<a href="mqtt.h.html#533">rx_buf</a>;</div><div id="534" class="line none">  534 </div><div id="535" class="line none">  535         /** Size of receive buffer. */</div><div id="536" class="line none">  536         uint32_t <a href="mqtt.h.html#536">rx_buf_size</a>;</div><div id="537" class="line none">  537 </div><div id="538" class="line none">  538         /** Transmit buffer used for creating MQTT packet in TX path. */</div><div id="539" class="line none">  539         uint8_t *<a href="mqtt.h.html#539">tx_buf</a>;</div><div id="540" class="line none">  540 </div><div id="541" class="line none">  541         /** Size of transmit buffer. */</div><div id="542" class="line none">  542         uint32_t <a href="mqtt.h.html#542">tx_buf_size</a>;</div><div id="543" class="line none">  543 </div><div id="544" class="line none">  544         /** Keepalive interval for this client in seconds.</div><div id="545" class="line none">  545          *  Default is CONFIG_MQTT_KEEPALIVE.</div><div id="546" class="line none">  546          */</div><div id="547" class="line none">  547         uint16_t <a href="mqtt.h.html#547">keepalive</a>;</div><div id="548" class="line none">  548 </div><div id="549" class="line none">  549         /** MQTT protocol version. */</div><div id="550" class="line none">  550         uint8_t <a href="mqtt.h.html#550">protocol_version</a>;</div><div id="551" class="line none">  551 </div><div id="552" class="line none">  552         /** Unanswered PINGREQ count on this connection. */</div><div id="553" class="line none">  553         int8_t <a href="mqtt.h.html#553">unacked_ping</a>;</div><div id="554" class="line none">  554 </div><div id="555" class="line none">  555         /** Will retain flag, 1 if will message shall be retained persistently.</div><div id="556" class="line none">  556          */</div><div id="557" class="line none">  557         uint8_t <a href="mqtt.h.html#557">will_retain</a> : 1;</div><div id="558" class="line none">  558 </div><div id="559" class="line none">  559         /** Clean session flag indicating a fresh (1) or a retained session (0).</div><div id="560" class="line none">  560          *  Default is CONFIG_MQTT_CLEAN_SESSION.</div><div id="561" class="line none">  561          */</div><div id="562" class="line none">  562         uint8_t <a href="mqtt.h.html#562">clean_session</a> : 1;</div><div id="563" class="line none">  563 </div><div id="564" class="line none">  564         /** User specific opaque data */</div><div id="565" class="line none">  565         void *<a href="../kernel.h.html#1470">user_data</a>;</div><div id="566" class="line none">  566 };</div><div id="567" class="line none">  567 </div><div id="568" class="line none">  568 /**</div><div id="569" class="line none">  569  * @brief Initializes the client instance.</div><div id="570" class="line none">  570  *</div><div id="571" class="line none">  571  * @param[in] client Client instance for which the procedure is requested.</div><div id="572" class="line none">  572  *                   Shall not be NULL.</div><div id="573" class="line none">  573  *</div><div id="574" class="line none">  574  * @note Shall be called to initialize client structure, before setting any</div><div id="575" class="line none">  575  *       client parameters and before connecting to broker.</div><div id="576" class="line none">  576  */</div><div id="577" class="line none">  577 void mqtt_client_init(struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="578" class="line none">  578 </div><div id="579" class="line none">  579 #if defined(CONFIG_SOCKS)</div><div id="580" class="line none">  580 /*</div><div id="581" class="line none">  581  * @brief Set proxy server details</div><div id="582" class="line none">  582  *</div><div id="583" class="line none">  583  * @param[in] client Client instance for which the procedure is requested,</div><div id="584" class="line none">  584  *                   Shall not be NULL.</div><div id="585" class="line none">  585  * @param[in] proxy_addr Proxy server address.</div><div id="586" class="line none">  586  * @param[in] addrlen Proxy server address length.</div><div id="587" class="line none">  587  *</div><div id="588" class="line none">  588  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="589" class="line none">  589  *</div><div id="590" class="line none">  590  * @note Must be called before calling mqtt_connect().</div><div id="591" class="line none">  591  */</div><div id="592" class="line none">  592 int mqtt_client_set_proxy(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="593" class="line none">  593                           struct sockaddr *proxy_addr,</div><div id="594" class="line none">  594                           socklen_t <a href="mqtt.h.html#465">addrlen</a>);</div><div id="595" class="line none">  595 #endif</div><div id="596" class="line none">  596 </div><div id="597" class="line none">  597 /**</div><div id="598" class="line none">  598  * @brief API to request new MQTT client connection.</div><div id="599" class="line none">  599  *</div><div id="600" class="line none">  600  * @param[in] client Client instance for which the procedure is requested.</div><div id="601" class="line none">  601  *                   Shall not be NULL.</div><div id="602" class="line none">  602  *</div><div id="603" class="line none">  603  * @note This memory is assumed to be resident until mqtt_disconnect is called.</div><div id="604" class="line none">  604  * @note Any subsequent changes to parameters like broker address, user name,</div><div id="605" class="line none">  605  *       device id, etc. have no effect once MQTT connection is established.</div><div id="606" class="line none">  606  *</div><div id="607" class="line none">  607  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="608" class="line none">  608  *</div><div id="609" class="line none">  609  * @note Default protocol revision used for connection request is 3.1.1. Please</div><div id="610" class="line none">  610  *       set client.protocol_version = MQTT_VERSION_3_1_0 to use protocol 3.1.0.</div><div id="611" class="line none">  611  * @note</div><div id="612" class="line none">  612  *       Please modify @kconfig{CONFIG_MQTT_KEEPALIVE} time to override default</div><div id="613" class="line none">  613  *       of 1 minute.</div><div id="614" class="line none">  614  */</div><div id="615" class="line none">  615 int mqtt_connect(struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="616" class="line none">  616 </div><div id="617" class="line none">  617 /**</div><div id="618" class="line none">  618  * @brief API to publish messages on topics.</div><div id="619" class="line none">  619  *</div><div id="620" class="line none">  620  * @param[in] client Client instance for which the procedure is requested.</div><div id="621" class="line none">  621  *                   Shall not be NULL.</div><div id="622" class="line none">  622  * @param[in] param Parameters to be used for the publish message.</div><div id="623" class="line none">  623  *                  Shall not be NULL.</div><div id="624" class="line none">  624  *</div><div id="625" class="line none">  625  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="626" class="line none">  626  */</div><div id="627" class="line none">  627 int mqtt_publish(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="628" class="line none">  628                  const struct <a href="mqtt.h.html#249">mqtt_publish_param</a> *<a href="mqtt.h.html#322">param</a>);</div><div id="629" class="line none">  629 </div><div id="630" class="line none">  630 /**</div><div id="631" class="line none">  631  * @brief API used by client to send acknowledgment on receiving QoS1 publish</div><div id="632" class="line none">  632  *        message. Should be called on reception of @ref MQTT_EVT_PUBLISH with</div><div id="633" class="line none">  633  *        QoS level @ref MQTT_QOS_1_AT_LEAST_ONCE.</div><div id="634" class="line none">  634  *</div><div id="635" class="line none">  635  * @param[in] client Client instance for which the procedure is requested.</div><div id="636" class="line none">  636  *                   Shall not be NULL.</div><div id="637" class="line none">  637  * @param[in] param Identifies message being acknowledged.</div><div id="638" class="line none">  638  *</div><div id="639" class="line none">  639  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="640" class="line none">  640  */</div><div id="641" class="line none">  641 int mqtt_publish_qos1_ack(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="642" class="line none">  642                           const struct <a href="mqtt.h.html#209">mqtt_puback_param</a> *<a href="mqtt.h.html#322">param</a>);</div><div id="643" class="line none">  643 </div><div id="644" class="line none">  644 /**</div><div id="645" class="line none">  645  * @brief API used by client to send acknowledgment on receiving QoS2 publish</div><div id="646" class="line none">  646  *        message. Should be called on reception of @ref MQTT_EVT_PUBLISH with</div><div id="647" class="line none">  647  *        QoS level @ref MQTT_QOS_2_EXACTLY_ONCE.</div><div id="648" class="line none">  648  *</div><div id="649" class="line none">  649  * @param[in] client Identifies client instance for which the procedure is</div><div id="650" class="line none">  650  *                   requested. Shall not be NULL.</div><div id="651" class="line none">  651  * @param[in] param Identifies message being acknowledged.</div><div id="652" class="line none">  652  *</div><div id="653" class="line none">  653  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="654" class="line none">  654  */</div><div id="655" class="line none">  655 int mqtt_publish_qos2_receive(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="656" class="line none">  656                               const struct <a href="mqtt.h.html#215">mqtt_pubrec_param</a> *<a href="mqtt.h.html#322">param</a>);</div><div id="657" class="line none">  657 </div><div id="658" class="line none">  658 /**</div><div id="659" class="line none">  659  * @brief API used by client to request release of QoS2 publish message.</div><div id="660" class="line none">  660  *        Should be called on reception of @ref MQTT_EVT_PUBREC.</div><div id="661" class="line none">  661  *</div><div id="662" class="line none">  662  * @param[in] client Client instance for which the procedure is requested.</div><div id="663" class="line none">  663  *                   Shall not be NULL.</div><div id="664" class="line none">  664  * @param[in] param Identifies message being released.</div><div id="665" class="line none">  665  *</div><div id="666" class="line none">  666  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="667" class="line none">  667  */</div><div id="668" class="line none">  668 int mqtt_publish_qos2_release(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="669" class="line none">  669                               const struct <a href="mqtt.h.html#221">mqtt_pubrel_param</a> *<a href="mqtt.h.html#322">param</a>);</div><div id="670" class="line none">  670 </div><div id="671" class="line none">  671 /**</div><div id="672" class="line none">  672  * @brief API used by client to send acknowledgment on receiving QoS2 publish</div><div id="673" class="line none">  673  *        release message. Should be called on reception of</div><div id="674" class="line none">  674  *        @ref MQTT_EVT_PUBREL.</div><div id="675" class="line none">  675  *</div><div id="676" class="line none">  676  * @param[in] client Identifies client instance for which the procedure is</div><div id="677" class="line none">  677  *                   requested. Shall not be NULL.</div><div id="678" class="line none">  678  * @param[in] param Identifies message being completed.</div><div id="679" class="line none">  679  *</div><div id="680" class="line none">  680  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="681" class="line none">  681  */</div><div id="682" class="line none">  682 int mqtt_publish_qos2_complete(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="683" class="line none">  683                                const struct <a href="mqtt.h.html#227">mqtt_pubcomp_param</a> *<a href="mqtt.h.html#322">param</a>);</div><div id="684" class="line none">  684 </div><div id="685" class="line none">  685 /**</div><div id="686" class="line none">  686  * @brief API to request subscription of one or more topics on the connection.</div><div id="687" class="line none">  687  *</div><div id="688" class="line none">  688  * @param[in] client Identifies client instance for which the procedure</div><div id="689" class="line none">  689  *                   is requested. Shall not be NULL.</div><div id="690" class="line none">  690  * @param[in] param Subscription parameters. Shall not be NULL.</div><div id="691" class="line none">  691  *</div><div id="692" class="line none">  692  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="693" class="line none">  693  */</div><div id="694" class="line none">  694 int mqtt_subscribe(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="695" class="line none">  695                    const struct <a href="mqtt.h.html#270">mqtt_subscription_list</a> *<a href="mqtt.h.html#322">param</a>);</div><div id="696" class="line none">  696 </div><div id="697" class="line none">  697 /**</div><div id="698" class="line none">  698  * @brief API to request unsubscription of one or more topics on the connection.</div><div id="699" class="line none">  699  *</div><div id="700" class="line none">  700  * @param[in] client Identifies client instance for which the procedure is</div><div id="701" class="line none">  701  *                   requested. Shall not be NULL.</div><div id="702" class="line none">  702  * @param[in] param Parameters describing topics being unsubscribed from.</div><div id="703" class="line none">  703  *                  Shall not be NULL.</div><div id="704" class="line none">  704  *</div><div id="705" class="line none">  705  * @note QoS included in topic description is unused in this API.</div><div id="706" class="line none">  706  *</div><div id="707" class="line none">  707  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="708" class="line none">  708  */</div><div id="709" class="line none">  709 int mqtt_unsubscribe(struct <a href="mqtt.h.html#330">mqtt_client</a> *client,</div><div id="710" class="line none">  710                      const struct <a href="mqtt.h.html#270">mqtt_subscription_list</a> *<a href="mqtt.h.html#322">param</a>);</div><div id="711" class="line none">  711 </div><div id="712" class="line none">  712 /**</div><div id="713" class="line none">  713  * @brief API to send MQTT ping. The use of this API is optional, as the library</div><div id="714" class="line none">  714  *        handles the connection keep-alive on it's own, see @ref mqtt_live.</div><div id="715" class="line none">  715  *</div><div id="716" class="line none">  716  * @param[in] client Identifies client instance for which procedure is</div><div id="717" class="line none">  717  *                   requested.</div><div id="718" class="line none">  718  *</div><div id="719" class="line none">  719  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="720" class="line none">  720  */</div><div id="721" class="line none">  721 int mqtt_ping(struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="722" class="line none">  722 </div><div id="723" class="line none">  723 /**</div><div id="724" class="line none">  724  * @brief API to disconnect MQTT connection.</div><div id="725" class="line none">  725  *</div><div id="726" class="line none">  726  * @param[in] client Identifies client instance for which procedure is</div><div id="727" class="line none">  727  *                   requested.</div><div id="728" class="line none">  728  *</div><div id="729" class="line none">  729  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="730" class="line none">  730  */</div><div id="731" class="line none">  731 int mqtt_disconnect(struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="732" class="line none">  732 </div><div id="733" class="line none">  733 /**</div><div id="734" class="line none">  734  * @brief API to abort MQTT connection. This will close the corresponding</div><div id="735" class="line none">  735  *        transport without closing the connection gracefully at the MQTT level</div><div id="736" class="line none">  736  *        (with disconnect message).</div><div id="737" class="line none">  737  *</div><div id="738" class="line none">  738  * @param[in] client Identifies client instance for which procedure is</div><div id="739" class="line none">  739  *                   requested.</div><div id="740" class="line none">  740  *</div><div id="741" class="line none">  741  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="742" class="line none">  742  */</div><div id="743" class="line none">  743 int mqtt_abort(struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="744" class="line none">  744 </div><div id="745" class="line none">  745 /**</div><div id="746" class="line none">  746  * @brief This API should be called periodically for the client to be able</div><div id="747" class="line none">  747  *        to keep the connection alive by sending Ping Requests if need be.</div><div id="748" class="line none">  748  *</div><div id="749" class="line none">  749  * @param[in] client Client instance for which the procedure is requested.</div><div id="750" class="line none">  750  *                   Shall not be NULL.</div><div id="751" class="line none">  751  *</div><div id="752" class="line none">  752  * @note  Application shall ensure that the periodicity of calling this function</div><div id="753" class="line none">  753  *        makes it possible to respect the Keep Alive time agreed with the</div><div id="754" class="line none">  754  *        broker on connection. @ref mqtt_connect for details on Keep Alive</div><div id="755" class="line none">  755  *        time.</div><div id="756" class="line none">  756  *</div><div id="757" class="line none">  757  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="758" class="line none">  758  */</div><div id="759" class="line none">  759 int mqtt_live(struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="760" class="line none">  760 </div><div id="761" class="line none">  761 /**</div><div id="762" class="line none">  762  * @brief Helper function to determine when next keep alive message should be</div><div id="763" class="line none">  763  *        sent. Can be used for instance as a source for `poll` timeout.</div><div id="764" class="line none">  764  *</div><div id="765" class="line none">  765  * @param[in] client Client instance for which the procedure is requested.</div><div id="766" class="line none">  766  *</div><div id="767" class="line none">  767  * @return Time in milliseconds until next keep alive message is expected to</div><div id="768" class="line none">  768  *         be sent. Function will return -1 if keep alive messages are</div><div id="769" class="line none">  769  *         not enabled.</div><div id="770" class="line none">  770  */</div><div id="771" class="line none">  771 int mqtt_keepalive_time_left(const struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="772" class="line none">  772 </div><div id="773" class="line none">  773 /**</div><div id="774" class="line none">  774  * @brief Receive an incoming MQTT packet. The registered callback will be</div><div id="775" class="line none">  775  *        called with the packet content.</div><div id="776" class="line none">  776  *</div><div id="777" class="line none">  777  * @note In case of PUBLISH message, the payload has to be read separately with</div><div id="778" class="line none">  778  *       @ref mqtt_read_publish_payload function. The size of the payload to</div><div id="779" class="line none">  779  *       read is provided in the publish event structure.</div><div id="780" class="line none">  780  *</div><div id="781" class="line none">  781  * @note This is a non-blocking call.</div><div id="782" class="line none">  782  *</div><div id="783" class="line none">  783  * @param[in] client Client instance for which the procedure is requested.</div><div id="784" class="line none">  784  *                   Shall not be NULL.</div><div id="785" class="line none">  785  *</div><div id="786" class="line none">  786  * @return 0 or a negative error code (errno.h) indicating reason of failure.</div><div id="787" class="line none">  787  */</div><div id="788" class="line none">  788 int mqtt_input(struct <a href="mqtt.h.html#330">mqtt_client</a> *client);</div><div id="789" class="line none">  789 </div><div id="790" class="line none">  790 /**</div><div id="791" class="line none">  791  * @brief Read the payload of the received PUBLISH message. This function should</div><div id="792" class="line none">  792  *        be called within the MQTT event handler, when MQTT PUBLISH message is</div><div id="793" class="line none">  793  *        notified.</div><div id="794" class="line none">  794  *</div><div id="795" class="line none">  795  * @note This is a non-blocking call.</div><div id="796" class="line none">  796  *</div><div id="797" class="line none">  797  * @param[in] client Client instance for which the procedure is requested.</div><div id="798" class="line none">  798  *                   Shall not be NULL.</div><div id="799" class="line none">  799  * @param[out] buffer Buffer where payload should be stored.</div><div id="800" class="line none">  800  * @param[in] length Length of the buffer, in bytes.</div><div id="801" class="line none">  801  *</div><div id="802" class="line none">  802  * @return Number of bytes read or a negative error code (errno.h) indicating</div><div id="803" class="line none">  803  *         reason of failure.</div><div id="804" class="line none">  804  */</div><div id="805" class="line none">  805 int mqtt_read_publish_payload(struct <a href="mqtt.h.html#330">mqtt_client</a> *client, void *<a href="../kernel.h.html#4868">buffer</a>,</div><div id="806" class="line none">  806                               size_t length);</div><div id="807" class="line none">  807 </div><div id="808" class="line none">  808 /**</div><div id="809" class="line none">  809  * @brief Blocking version of @ref mqtt_read_publish_payload function.</div><div id="810" class="line none">  810  *</div><div id="811" class="line none">  811  * @param[in] client Client instance for which the procedure is requested.</div><div id="812" class="line none">  812  *                   Shall not be NULL.</div><div id="813" class="line none">  813  * @param[out] buffer Buffer where payload should be stored.</div><div id="814" class="line none">  814  * @param[in] length Length of the buffer, in bytes.</div><div id="815" class="line none">  815  *</div><div id="816" class="line none">  816  * @return Number of bytes read or a negative error code (errno.h) indicating</div><div id="817" class="line none">  817  *         reason of failure.</div><div id="818" class="line none">  818  */</div><div id="819" class="line none">  819 int mqtt_read_publish_payload_blocking(struct <a href="mqtt.h.html#330">mqtt_client</a> *client, void *<a href="../kernel.h.html#4868">buffer</a>,</div><div id="820" class="line none">  820                                        size_t length);</div><div id="821" class="line none">  821 </div><div id="822" class="line none">  822 /**</div><div id="823" class="line none">  823  * @brief Blocking version of @ref mqtt_read_publish_payload function which</div><div id="824" class="line none">  824  *        runs until the required number of bytes are read.</div><div id="825" class="line none">  825  *</div><div id="826" class="line none">  826  * @param[in] client Client instance for which the procedure is requested.</div><div id="827" class="line none">  827  *                   Shall not be NULL.</div><div id="828" class="line none">  828  * @param[out] buffer Buffer where payload should be stored.</div><div id="829" class="line none">  829  * @param[in] length Number of bytes to read.</div><div id="830" class="line none">  830  *</div><div id="831" class="line none">  831  * @return 0 if success, otherwise a negative error code (errno.h) indicating</div><div id="832" class="line none">  832  *         reason of failure.</div><div id="833" class="line none">  833  */</div><div id="834" class="line none">  834 int mqtt_readall_publish_payload(struct <a href="mqtt.h.html#330">mqtt_client</a> *client, uint8_t *<a href="../kernel.h.html#4868">buffer</a>,</div><div id="835" class="line none">  835                                  size_t length);</div><div id="836" class="line none">  836 </div><div id="837" class="line none">  837 #ifdef __cplusplus</div><div id="838" class="line none">  838 }</div><div id="839" class="line none">  839 #endif</div><div id="840" class="line none">  840 </div><div id="841" class="line none">  841 #endif /* ZEPHYR_INCLUDE_NET_MQTT_H_ */</div><div id="842" class="line none">  842 </div><div id="843" class="line none">  843 /**@}  */</div>
</div>
</body>
</html>
